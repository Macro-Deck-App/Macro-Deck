"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[172],{172:(_n,y,a)=>{a.r(y),a.d(y,{HomePageModule:()=>pn});var f=a(177),v=a(4341),l=a(8974),S=a(8160),u=a(467),F=a(5312),M=a(6123),n=a(4438),I=a(7709),P=a(6824);let T=(()=>{var o;class c{constructor(e,t){this.modalController=e,this.alertController=t,this.id="",this.host="",this.port=8191,this.useSsl=!1,this.autoConnect=!0,this.index=0}cancel(){var e=this;return(0,u.A)(function*(){yield e.modalController.dismiss(null,"cancel")})()}confirm(){var e=this;return(0,u.A)(function*(){if(!(yield e.validate()))return;let t={host:e.host,id:e.id,name:void 0===e.name||0===e.name.length?e.host:e.name,port:e.port,ssl:e.useSsl,index:e.index,autoConnect:e.autoConnect};console.log(t),yield e.modalController.dismiss(t,"confirm")})()}validate(){var e=this;return(0,u.A)(function*(){return void 0===e.host||0===e.host.length?(yield e.showErrorAlert("The IP Address / Hostname is required."),!1):null!=e.port||(yield e.showErrorAlert("The port is required."),!1)})()}showErrorAlert(e){var t=this;return(0,u.A)(function*(){yield(yield t.alertController.create({subHeader:e,buttons:[{text:"Ok"}]})).present()})()}}return(o=c).\u0275fac=function(e){return new(e||o)(n.rXU(l.W3),n.rXU(l.hG))},o.\u0275cmp=n.VBU({type:o,selectors:[["app-add-connection-modal"]],decls:29,vars:9,consts:[["slot","start"],[3,"click"],["slot","end"],[3,"click","strong"],[1,"ion-padding"],["labelPlacement","floating","type","text",3,"ngModelChange","placeholder","ngModel","clearInput"],["slot","label"],[3,"ngModelChange","ngModel"],[1,"mt-2"],["labelPlacement","floating","type","text",3,"ngModelChange","ngModel","clearInput"],["min","1","labelPlacement","floating","type","number",3,"ngModelChange","ngModel"]],template:function(e,t){1&e&&(n.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),n.bIt("click",function(){return t.cancel()}),n.EFF(4,"Cancel"),n.k0s()(),n.j41(5,"ion-title"),n.EFF(6,"Add connection"),n.k0s(),n.j41(7,"ion-buttons",2)(8,"ion-button",3),n.bIt("click",function(){return t.confirm()}),n.EFF(9,"Confirm"),n.k0s()()()(),n.j41(10,"ion-content",4)(11,"ion-item")(12,"ion-input",5),n.mxI("ngModelChange",function(r){return n.DH7(t.name,r)||(t.name=r),r}),n.j41(13,"div",6),n.EFF(14,"Name"),n.k0s()()(),n.j41(15,"ion-item")(16,"ion-toggle",7),n.mxI("ngModelChange",function(r){return n.DH7(t.autoConnect,r)||(t.autoConnect=r),r}),n.EFF(17,"Automatically connect"),n.k0s()(),n.j41(18,"ion-item",8)(19,"ion-input",9),n.mxI("ngModelChange",function(r){return n.DH7(t.host,r)||(t.host=r),r}),n.j41(20,"div",6),n.EFF(21,"IP Address / Hostname"),n.k0s()()(),n.j41(22,"ion-item")(23,"ion-input",10),n.mxI("ngModelChange",function(r){return n.DH7(t.port,r)||(t.port=r),r}),n.j41(24,"div",6),n.EFF(25,"Port"),n.k0s()()(),n.j41(26,"ion-item")(27,"ion-toggle",7),n.mxI("ngModelChange",function(r){return n.DH7(t.useSsl,r)||(t.useSsl=r),r}),n.EFF(28,"Use SSL"),n.k0s()()()),2&e&&(n.R7$(8),n.Y8G("strong",!0),n.R7$(4),n.Y8G("placeholder",t.host),n.R50("ngModel",t.name),n.Y8G("clearInput",!0),n.R7$(4),n.R50("ngModel",t.autoConnect),n.R7$(3),n.R50("ngModel",t.host),n.Y8G("clearInput",!0),n.R7$(4),n.R50("ngModel",t.port),n.R7$(4),n.R50("ngModel",t.useSsl))},dependencies:[v.BC,v.vS,l.Jm,l.QW,l.W9,l.eU,l.$w,l.uz,l.BC,l.BY,l.ai,l.hB,l.su,l.Gw,l.T6]}),c})();var h=a(8359),E=a(369);let k=(()=>{var o;class c{constructor(e){this.storage=e,this.connectionsStorageKey="connections"}getConnections(){var e=this;return(0,u.A)(function*(){const t=yield e.storage.get(e.connectionsStorageKey);return null==t?[]:JSON.parse(t).sort((i,r)=>{var d,m;return(null!==(d=i.index)&&void 0!==d?d:0)-(null!==(m=r.index)&&void 0!==m?m:0)})})()}saveConnections(e){var t=this;return(0,u.A)(function*(){yield t.storage.set(t.connectionsStorageKey,JSON.stringify(e))})()}addUpdateConnection(e){var t=this;return(0,u.A)(function*(){var i;const r=yield t.storage.get(t.connectionsStorageKey);let d=null!==(i=JSON.parse(r))&&void 0!==i?i:[];if(void 0===e.id)e.id="connection".concat(Math.floor(Date.now()/1e3)),e.index=d.length,d.push(e);else{const m=d.findIndex(g=>g.id===e.id);m>-1?d[m]=e:d.push(e)}yield t.saveConnections(d)})()}deleteConnection(e){var t=this;return(0,u.A)(function*(){var i;const r=yield t.storage.get(t.connectionsStorageKey);let d=null!==(i=JSON.parse(r))&&void 0!==i?i:[];const m=d.findIndex(g=>g.id==e);m>-1&&d.splice(m,1),yield t.storage.set(t.connectionsStorageKey,JSON.stringify(d))})()}}return(o=c).\u0275fac=function(e){return new(e||o)(n.KVO(E.w))},o.\u0275prov=n.jDH({token:o,factory:o.\u0275fac,providedIn:"root"}),c})();var R=a(1969),x=a(851),j=a(8839),G=a(1807),U=a(5558),$=a(8211),D=a(9974),N=a(8750),O=a(1853),X=a(4360),V=a(5225);const B=(0,O.L)(o=>function(s=null){o(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=s});function w(o){throw new B(o)}var W=a(9437),J=a(7673),z=a(1626);let L=(()=>{var o;class c{constructor(e,t){this.http=e,this.connectionService=t,this.connectionAvailable=new n.bkB,this.connectionUnavailable=new n.bkB,this.subscription=new h.yU,this.availableConnections=[]}start(){var e=this;return(0,u.A)(function*(){console.log("Start ping"),e.subscription=new h.yU;let t=yield e.connectionService.getConnections();for(const i of t)e.subscription.add(e.periodicRequest(e.getPingUrl(i),1500).subscribe(r=>{null!==r?e.addAvailableConnection(i):e.removeAvailableConnection(i)}))})()}stop(){console.log("Stop ping"),this.subscription.unsubscribe()}restart(){var e=this;return(0,u.A)(function*(){e.stop(),yield e.start()})()}getPingUrl(e){return"".concat(e.ssl?"https":"http","://").concat(e.host,":").concat(e.port,"/ping")}removeAvailableConnection(e){let t=this.availableConnections.findIndex(i=>i==e.id);-1!==t&&(this.availableConnections.splice(t,1),this.connectionUnavailable.emit(e.id))}addAvailableConnection(e){this.availableConnections.find(t=>t==e.id)||(this.availableConnections.push(e.id),this.connectionAvailable.emit(e.id))}periodicRequest(e,t){return function H(o=0,c=j.E){return o<0&&(o=0),(0,G.O)(o,o,c)}(t).pipe((0,U.n)(()=>this.http.get(e).pipe(function Y(o,c){const{first:s,each:e,with:t=w,scheduler:i=(null!=c?c:j.E),meta:r=null}=(0,$.v)(o)?{first:o}:"number"==typeof o?{each:o}:o;if(null==s&&null==e)throw new TypeError("No timeout provided.");return(0,D.N)((d,m)=>{let g,p,_=null,C=0;const A=b=>{p=(0,V.N)(m,i,()=>{try{g.unsubscribe(),(0,N.Tg)(t({meta:r,lastValue:_,seen:C})).subscribe(m)}catch(gn){m.error(gn)}},b)};g=d.subscribe((0,X._)(m,b=>{null==p||p.unsubscribe(),C++,m.next(_=b),e>0&&A(e)},void 0,void 0,()=>{null!=p&&p.closed||null==p||p.unsubscribe(),_=null})),!C&&A(null!=s?"number"==typeof s?s:+s-i.now():e)})}(800),(0,W.W)(i=>(0,J.of)(null)))))}}return(o=c).\u0275fac=function(e){return new(e||o)(n.KVO(z.Qq),n.KVO(k))},o.\u0275prov=n.jDH({token:o,factory:o.\u0275fac,providedIn:"root"}),c})();function K(o,c){1&o&&(n.qex(0),n.nrm(1,"ion-icon",17),n.bVm())}function Q(o,c){1&o&&(n.qex(0),n.nrm(1,"ion-icon",18),n.bVm())}function Z(o,c){1&o&&n.nrm(0,"ion-icon",19)}function q(o,c){if(1&o){const s=n.RV6();n.j41(0,"ion-item-sliding")(1,"ion-item",9),n.bIt("click",function(){const t=n.eBV(s).$implicit,i=n.XpG(4);return n.Njj(i.connect(t))}),n.DNE(2,K,2,0,"ng-container",3)(3,Q,2,0,"ng-container",3),n.j41(4,"ion-label")(5,"h3"),n.EFF(6),n.k0s(),n.j41(7,"span"),n.DNE(8,Z,1,0,"ion-icon",10),n.EFF(9),n.k0s()(),n.nrm(10,"ion-reorder",11),n.k0s(),n.j41(11,"ion-item-options",12)(12,"ion-item-option",13),n.bIt("click",function(){const t=n.eBV(s).$implicit,i=n.XpG(4);return n.Njj(i.editConnection(t))}),n.nrm(13,"ion-icon",14),n.k0s(),n.j41(14,"ion-item-option",15),n.bIt("click",function(){const t=n.eBV(s).$implicit,i=n.XpG(4);return n.Njj(i.deleteConnection(t))}),n.nrm(15,"ion-icon",16),n.k0s()()()}if(2&o){const s=c.$implicit,e=n.XpG(4);n.R7$(2),n.Y8G("ngIf",e.availableConnections.includes(s.id)),n.R7$(),n.Y8G("ngIf",!e.availableConnections.includes(s.id)),n.R7$(3),n.JRh(s.name),n.R7$(2),n.Y8G("ngIf",s.ssl),n.R7$(),n.Lme(" ",s.host,":",s.port," ")}}function nn(o,c){if(1&o){const s=n.RV6();n.j41(0,"ion-list",6)(1,"ion-reorder-group",7),n.bIt("ionItemReorder",function(t){n.eBV(s);const i=n.XpG(3);return n.Njj(i.handleReorder(t))}),n.DNE(2,q,16,6,"ion-item-sliding",8),n.k0s()()}if(2&o){const s=n.XpG(3);n.R7$(),n.Y8G("disabled",!s.reorderEnabled),n.R7$(),n.Y8G("ngForOf",s.savedConnections)}}function en(o,c){if(1&o&&(n.j41(0,"ion-item-group"),n.DNE(1,nn,3,2,"ion-list",5),n.k0s()),2&o){const s=n.XpG(2),e=n.sdS(4);n.R7$(),n.Y8G("ngIf",s.savedConnections.length>0)("ngIfElse",e)}}function tn(o,c){if(1&o){const s=n.RV6();n.j41(0,"ion-fab",20)(1,"ion-fab-button",21),n.bIt("click",function(){n.eBV(s);const t=n.XpG(2);return n.Njj(t.openAddConnectionModal())}),n.nrm(2,"ion-icon",22),n.k0s()()}}function on(o,c){if(1&o&&(n.j41(0,"ion-content"),n.DNE(1,en,2,2,"ion-item-group",3)(2,tn,3,0,"ion-fab",4),n.k0s()),2&o){const s=n.XpG();n.R7$(),n.Y8G("ngIf",s.savedConnectionsInitialized),n.R7$(),n.Y8G("ngIf",s.savedConnections.length>0)}}function sn(o,c){1&o&&(n.j41(0,"div",23)(1,"div",24),n.nrm(2,"ion-spinner"),n.k0s()())}function rn(o,c){if(1&o){const s=n.RV6();n.j41(0,"div",23)(1,"span",25),n.EFF(2,"You have set up no saved connections"),n.k0s(),n.j41(3,"div",24)(4,"ion-button",26),n.bIt("click",function(){n.eBV(s);const t=n.XpG();return n.Njj(t.openAddConnectionModal())}),n.nrm(5,"ion-icon",22),n.j41(6,"ion-label"),n.EFF(7,"Add connection"),n.k0s()()()()}}let ln=(()=>{var o;class c{constructor(e,t,i,r,d,m,g){this.connectionService=e,this.modalController=t,this.alertController=i,this.websocketService=r,this.wakeLockService=d,this.settingsService=m,this.pingService=g,this.subscription=new h.yU,this.savedConnections=[],this.availableConnections=[],this.savedConnectionsInitialized=!1,this.reorderEnabled=!0}ngOnInit(){var e=this;return(0,u.A)(function*(){yield e.loadConnections(),yield e.pingService.start(),e.subscription.add(e.pingService.connectionAvailable.subscribe(function(){var t=(0,u.A)(function*(i){if(!e.availableConnections.includes(i)){e.availableConnections.push(i);let r=e.savedConnections.find(d=>d.id==i);!0===(null==r?void 0:r.autoConnect)&&(yield e.connect(r))}});return function(i){return t.apply(this,arguments)}}())),e.subscription.add(e.pingService.connectionUnavailable.subscribe(t=>{e.availableConnections.includes(t)&&e.availableConnections.splice(e.availableConnections.indexOf(t),1)})),e.subscription.add(e.websocketService.connected.subscribe(t=>{e.pingService.stop()})),e.subscription.add(e.websocketService.closed.subscribe(t=>{e.pingService.start()}))})()}ngOnDestroy(){this.subscription.unsubscribe()}loadConnections(){var e=this;return(0,u.A)(function*(){var t;e.savedConnections=null!==(t=yield e.connectionService.getConnections())&&void 0!==t?t:[],e.savedConnectionsInitialized=!0})()}openAddConnectionModal(e){var t=this;return(0,u.A)(function*(){var i,r,d,m;const g=yield t.modalController.create({component:T,componentProps:{id:null==e?void 0:e.id,name:null==e?void 0:e.name,host:null==e?void 0:e.host,port:null!==(i=null==e?void 0:e.port)&&void 0!==i?i:8191,useSsl:null!==(r=null==e?void 0:e.ssl)&&void 0!==r&&r,autoConnect:null!==(d=null==e?void 0:e.autoConnect)&&void 0!==d&&d,index:null!==(m=null==e?void 0:e.index)&&void 0!==m?m:0}});yield g.present();const{data:p,role:_}=yield g.onWillDismiss();"confirm"===_&&(yield t.connectionService.addUpdateConnection(p),yield t.loadConnections(),yield t.pingService.restart())})()}handleReorder(e){var t=this;return(0,u.A)(function*(){t.savedConnections=e.detail.complete(t.savedConnections),t.updateIndexes(),yield t.connectionService.saveConnections(t.savedConnections)})()}updateIndexes(){for(let e=0;e<this.savedConnections.length;e++)this.savedConnections[e].index=e}deleteConnection(e){var t=this;return(0,u.A)(function*(){var r;yield(yield t.alertController.create({subHeader:"Delete the connection ".concat(e.name,"?"),buttons:[{text:"No",role:"cancel"},{text:"Yes",role:"confirm",handler:(r=(0,u.A)(function*(){yield t.connectionService.deleteConnection(e.id),yield t.loadConnections()}),function(){return r.apply(this,arguments)})}]})).present()})()}editConnection(e){var t=this;return(0,u.A)(function*(){yield t.openAddConnectionModal(e)})()}connect(e){var t=this;return(0,u.A)(function*(){yield t.wakeLockService.updateWakeLock(),yield t.websocketService.connect(e.host,e.port,e.ssl,e.id)})()}}return(o=c).\u0275fac=function(e){return new(e||o)(n.rXU(k),n.rXU(l.W3),n.rXU(l.hG),n.rXU(R.H),n.rXU(x.r),n.rXU(I.h),n.rXU(L))},o.\u0275cmp=n.VBU({type:o,selectors:[["app-connections"]],decls:5,vars:2,consts:[["connectionsLoading",""],["noConnections",""],[4,"ngIf","ngIfElse"],[4,"ngIf"],["slot","fixed","vertical","bottom","horizontal","end",4,"ngIf"],["lines","full",4,"ngIf","ngIfElse"],["lines","full"],[3,"ionItemReorder","disabled"],[4,"ngFor","ngForOf"],["button","true",3,"click"],["aria-hidden","true","title","Secure connection","class","text-success","name","lock-closed-outline",4,"ngIf"],["slot","end"],["side","end"],["color","warning",3,"click"],["slot","icon-only","name","ellipsis-horizontal"],["color","danger",3,"click"],["slot","icon-only","name","trash"],["slot","start",1,"mdi","mdi-wifi","text-success","d-flex","align-items-center"],["slot","start",1,"mdi","mdi-wifi-off","text-danger","d-flex","align-items-center"],["aria-hidden","true","title","Secure connection","name","lock-closed-outline",1,"text-success"],["slot","fixed","vertical","bottom","horizontal","end"],["color","success",3,"click"],["name","add"],[1,"ion-padding","d-flex","flex-column"],[1,"justify-content-center","d-flex","mt-3"],[1,"d-block","text-center"],["id","add-connection-button",3,"click"]],template:function(e,t){if(1&e&&n.DNE(0,on,3,2,"ion-content",2)(1,sn,3,0,"ng-template",null,0,n.C5r)(3,rn,8,0,"ng-template",null,1,n.C5r),2&e){const i=n.sdS(2);n.Y8G("ngIf",t.savedConnectionsInitialized)("ngIfElse",i)}},dependencies:[f.Sq,f.bT,l.Jm,l.W9,l.Q8,l.YW,l.iq,l.uz,l.jh,l.LU,l.CE,l.A7,l.he,l.nf,l.UB,l.p$,l.w2]}),c})();function cn(o,c){if(1&o){const s=n.RV6();n.j41(0,"ion-buttons",0)(1,"ion-button",4),n.bIt("click",function(){n.eBV(s);const t=n.XpG();return n.Njj(t.openDonate())}),n.EFF(2," Donate "),n.nrm(3,"ion-icon",5),n.k0s()()}}const an=[{path:"",component:(()=>{var o;class c{constructor(e,t,i,r){this.settingsService=e,this.diagnosticService=t,this.modalController=i,this.diagnosticsService=r,this.environment=F.c}ngOnInit(){var e=this;return(0,u.A)(function*(){e.clientId=yield e.settingsService.getClientId(),e.version=yield e.diagnosticsService.getVersion()})()}openSettings(){var e=this;return(0,u.A)(function*(){yield(yield e.modalController.create({component:M.M})).present()})()}showDonateButton(){return!this.diagnosticsService.isiOS()}openDonate(){window.open("https://ko-fi.com/manuelmayer","_blank")}}return(o=c).\u0275fac=function(e){return new(e||o)(n.rXU(I.h),n.rXU(P.T),n.rXU(l.W3),n.rXU(P.T))},o.\u0275cmp=n.VBU({type:o,selectors:[["app-home"]],decls:14,vars:3,consts:[["slot","primary"],[3,"click"],[1,"ms-3"],["slot","primary",4,"ngIf"],["fill","solid",3,"click"],["slot","end","name","heart-outline"]],template:function(e,t){1&e&&(n.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),n.EFF(3,"Macro Deck"),n.k0s(),n.j41(4,"ion-buttons",0)(5,"ion-button",1),n.bIt("click",function(){return t.openSettings()}),n.EFF(6,"Settings"),n.k0s()()()(),n.j41(7,"ion-content"),n.nrm(8,"app-connections"),n.k0s(),n.j41(9,"ion-footer")(10,"ion-toolbar")(11,"ion-text",2),n.EFF(12),n.k0s(),n.DNE(13,cn,4,0,"ion-buttons",3),n.k0s()()),2&e&&(n.R7$(12),n.Lme("",t.version," | Client Id: ",t.clientId,""),n.R7$(),n.Y8G("ngIf",t.showDonateButton()))},dependencies:[f.bT,l.Jm,l.QW,l.W9,l.M0,l.eU,l.iq,l.IO,l.BC,l.ai,ln],styles:[".splashscreen[_ngcontent-%COMP%]{position:absolute;top:0;right:0;bottom:0;left:0;background-color:var(--macro-deck-bg);z-index:100;opacity:100%;transition:opacity .3s ease-out}"]}),c})()}];let dn=(()=>{var o;class c{}return(o=c).\u0275fac=function(e){return new(e||o)},o.\u0275mod=n.$C({type:o}),o.\u0275inj=n.G2t({imports:[S.iI.forChild(an),S.iI]}),c})();var un=a(7862),mn=a(1473);let pn=(()=>{var o;class c{}return(o=c).\u0275fac=function(e){return new(e||o)},o.\u0275mod=n.$C({type:o}),o.\u0275inj=n.G2t({imports:[f.MD,v.YN,l.bv,dn,un.P,mn.WebHomePageModule]}),c})()}}]);