"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1969],{5928:(w,v,h)=>{h.d(v,{G:()=>l});var l=function(t){return t[t.empty=0]="empty",t[t.button=100]="button",t}(l||{})},3031:(w,v,h)=>{h.d(v,{Z:()=>l});var l=function(t){return t[t.ButtonPress=1e3]="ButtonPress",t[t.ButtonShortPressRelease=1001]="ButtonShortPressRelease",t[t.ButtonLongPress=1010]="ButtonLongPress",t[t.ButtonLongPressRelease=1011]="ButtonLongPressRelease",t}(l||{})},1083:(w,v,h)=>{h.d(v,{j:()=>t});var l=h(4438);let t=(()=>{var a;class _{constructor(){this.configUpdate=new l.bkB,this.interaction=new l.bkB,this.widgets=[],this.rows=3,this.columns=5,this.buttonSpacing=10,this.buttonRadius=40,this.buttonBackground=!0}setConfig(f){this.rows=f.Rows,this.columns=f.Columns,this.buttonSpacing=f.ButtonSpacing,this.buttonRadius=f.ButtonRadius,this.buttonBackground=f.ButtonBackground,this.configUpdate.emit()}setWidgets(f){this.widgets=f}updateWidget(f){let m=this.widgets.findIndex(k=>k.row==f.row&&k.column==f.column);-1!==m?this.widgets[m]=f:this.widgets.push(f)}}return(a=_).\u0275fac=function(f){return new(f||a)},a.\u0275prov=l.jDH({token:a,factory:a.\u0275fac,providedIn:"root"}),_})()},1969:(w,v,h)=>{h.d(v,{H:()=>K});var l=h(467),t=h(4438),a=h(8974);let _=(()=>{var i;class o{constructor(e){this.modalController=e,this.url="",this.errorInformation=""}dismiss(){var e=this;return(0,l.A)(function*(){yield e.modalController.dismiss()})()}}return(i=o).\u0275fac=function(e){return new(e||i)(t.rXU(a.W3))},i.\u0275cmp=t.VBU({type:i,selectors:[["app-connection-failed"]],decls:40,vars:3,consts:[["slot","end"],[3,"click","strong"],[1,"ion-padding"],["value","information"],["slot","header","color","light"],["slot","content",1,"ion-padding"],[1,"d-block","mt-3"],["value","first"],[1,"pre-wrap"]],template:function(e,n){1&e&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t.EFF(3),t.k0s(),t.j41(4,"ion-buttons",0)(5,"ion-button",1),t.bIt("click",function(){return n.dismiss()}),t.EFF(6,"Close"),t.k0s()()()(),t.j41(7,"ion-content",2)(8,"ion-accordion-group",3)(9,"ion-accordion",3)(10,"ion-item",4)(11,"ion-label"),t.EFF(12,"Information"),t.k0s()(),t.j41(13,"div",5)(14,"b",6),t.EFF(15,"There can be multiple reasons why this happens:"),t.k0s(),t.j41(16,"ul")(17,"li"),t.EFF(18,"Your anti virus software or firewall blocks Macro Deck (Common issue)"),t.k0s(),t.j41(19,"li"),t.EFF(20,"The wrong network adapter is chosen in the settings on the PC app"),t.k0s(),t.j41(21,"li"),t.EFF(22,"The chosen port is used by another application"),t.k0s(),t.j41(23,"li"),t.EFF(24,"Your computer and this device are not in the same network"),t.k0s(),t.j41(25,"li"),t.EFF(26,"If you're using VPN services, disable them"),t.k0s(),t.j41(27,"li"),t.EFF(28,"A restart of your computer can help sometimes"),t.k0s(),t.j41(29,"li"),t.EFF(30,"If you're using a 5GHz Wi-Fi connection, try to switch to 2,4GHz temporarily"),t.k0s(),t.j41(31,"li"),t.EFF(32,"Some routers block the communication between Ethernet and Wi-Fi. Check your router settings. Look for SSID isolation or AP isolation and disable it."),t.k0s()()()(),t.j41(33,"ion-accordion",7)(34,"ion-item",4)(35,"ion-label"),t.EFF(36,"Details"),t.k0s()(),t.j41(37,"div",5)(38,"span",8),t.EFF(39),t.k0s()()()()()),2&e&&(t.R7$(3),t.SpI("Unable to connect to ",n.url,""),t.R7$(2),t.Y8G("strong",!0),t.R7$(34),t.JRh(n.errorInformation))},dependencies:[a.xk,a.YH,a.Jm,a.QW,a.W9,a.eU,a.uz,a.he,a.BC,a.ai],styles:[".pre-wrap[_ngcontent-%COMP%]{white-space:pre-wrap}"]}),o})();class S{static getConnectedMessage(o){return{Method:"CONNECTED","Client-Id":o,API:"20","Device-Type":"Web"}}static getGetButtonsMessage(){return{Method:"GET_BUTTONS"}}}let f=(()=>{var i;class o{constructor(e){this.modalController=e}ngOnInit(){}dismiss(){var e=this;return(0,l.A)(function*(){yield e.modalController.dismiss()})()}}return(i=o).\u0275fac=function(e){return new(e||i)(t.rXU(a.W3))},i.\u0275cmp=t.VBU({type:i,selectors:[["app-insecure-connection"]],decls:17,vars:1,consts:[["slot","end"],[3,"click","strong"],[1,"ion-padding"],[1,"d-block","mt-3"]],template:function(e,n){1&e&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t.EFF(3,"Connection failed"),t.k0s(),t.j41(4,"ion-buttons",0)(5,"ion-button",1),t.bIt("click",function(){return n.dismiss()}),t.EFF(6,"Close"),t.k0s()()()(),t.j41(7,"ion-content",2)(8,"ion-text")(9,"h4"),t.EFF(10,"I was able to connect but there were some problems \u26a0\ufe0f"),t.k0s(),t.j41(11,"span",3),t.EFF(12," It seems like your browser blocks the connection because of security issues."),t.nrm(13,"br"),t.EFF(14," This is caused by the client being accessed over a https connection and the server is not accessed wss."),t.nrm(15,"br"),t.EFF(16," To solve this, allow insecure connections from https in your browser. "),t.k0s()()()),2&e&&(t.R7$(5),t.Y8G("strong",!0))},dependencies:[a.Jm,a.QW,a.W9,a.eU,a.IO,a.BC,a.ai]}),o})();var m=h(1413),k=h(8359),j=h(7707),I=h(1985),W=h(6129);class F extends m.B{constructor(o=1/0,r=1/0,e=W.U){super(),this._bufferSize=o,this._windowTime=r,this._timestampProvider=e,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=r===1/0,this._bufferSize=Math.max(1,o),this._windowTime=Math.max(1,r)}next(o){const{isStopped:r,_buffer:e,_infiniteTimeWindow:n,_timestampProvider:s,_windowTime:c}=this;r||(e.push(o),!n&&e.push(s.now()+c)),this._trimBuffer(),super.next(o)}_subscribe(o){this._throwIfClosed(),this._trimBuffer();const r=this._innerSubscribe(o),{_infiniteTimeWindow:e,_buffer:n}=this,s=n.slice();for(let c=0;c<s.length&&!o.closed;c+=e?1:2)o.next(s[c]);return this._checkFinalizedStatuses(o),r}_trimBuffer(){const{_bufferSize:o,_timestampProvider:r,_buffer:e,_infiniteTimeWindow:n}=this,s=(n?1:2)*o;if(o<1/0&&s<e.length&&e.splice(0,e.length-s),!n){const c=r.now();let d=0;for(let u=1;u<e.length&&e[u]<=c;u+=2)d=u;d&&e.splice(0,d+1)}}}const x={url:"",deserializer:i=>JSON.parse(i.data),serializer:i=>JSON.stringify(i)};class B extends m.k{constructor(o,r){if(super(),this._socket=null,o instanceof I.c)this.destination=r,this.source=o;else{const e=this._config=Object.assign({},x);if(this._output=new m.B,"string"==typeof o)e.url=o;else for(const n in o)o.hasOwnProperty(n)&&(e[n]=o[n]);if(!e.WebSocketCtor&&WebSocket)e.WebSocketCtor=WebSocket;else if(!e.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new F}}lift(o){const r=new B(this._config,this.destination);return r.operator=o,r.source=this,r}_resetState(){this._socket=null,this.source||(this.destination=new F),this._output=new m.B}multiplex(o,r,e){const n=this;return new I.c(s=>{try{n.next(o())}catch(d){s.error(d)}const c=n.subscribe({next:d=>{try{e(d)&&s.next(d)}catch(u){s.error(u)}},error:d=>s.error(d),complete:()=>s.complete()});return()=>{try{n.next(r())}catch(d){s.error(d)}c.unsubscribe()}})}_connectSocket(){const{WebSocketCtor:o,protocol:r,url:e,binaryType:n}=this._config,s=this._output;let c=null;try{c=r?new o(e,r):new o(e),this._socket=c,n&&(this._socket.binaryType=n)}catch(u){return void s.error(u)}const d=new k.yU(()=>{this._socket=null,c&&1===c.readyState&&c.close()});c.onopen=u=>{const{_socket:p}=this;if(!p)return c.close(),void this._resetState();const{openObserver:b}=this._config;b&&b.next(u);const E=this.destination;this.destination=j.vU.create(g=>{if(1===c.readyState)try{const{serializer:C}=this._config;c.send(C(g))}catch(C){this.destination.error(C)}},g=>{const{closingObserver:C}=this._config;C&&C.next(void 0),g&&g.code?c.close(g.code,g.reason):s.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),this._resetState()},()=>{const{closingObserver:g}=this._config;g&&g.next(void 0),c.close(),this._resetState()}),E&&E instanceof F&&d.add(E.subscribe(this.destination))},c.onerror=u=>{this._resetState(),s.error(u)},c.onclose=u=>{c===this._socket&&this._resetState();const{closeObserver:p}=this._config;p&&p.next(u),u.wasClean?s.complete():s.error(u)},c.onmessage=u=>{try{const{deserializer:p}=this._config;s.next(p(u))}catch(p){s.error(p)}}}_subscribe(o){const{source:r}=this;return r?r.subscribe(o):(this._socket||this._connectSocket(),this._output.subscribe(o),o.add(()=>{const{_socket:e}=this;0===this._output.observers.length&&(e&&(1===e.readyState||0===e.readyState)&&e.close(),this._resetState())}),o)}unsubscribe(){const{_socket:o}=this;o&&(1===o.readyState||0===o.readyState)&&o.close(),this._resetState(),super.unsubscribe()}}let R=(()=>{var i;class o{constructor(e){this.modalController=e}dismiss(){var e=this;return(0,l.A)(function*(){yield e.modalController.dismiss()})()}}return(i=o).\u0275fac=function(e){return new(e||i)(t.rXU(a.W3))},i.\u0275cmp=t.VBU({type:i,selectors:[["app-connection-lost"]],decls:13,vars:1,consts:[["slot","end"],[3,"click","strong"],[1,"ion-padding"],[1,"d-block","mt-3"]],template:function(e,n){1&e&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t.EFF(3,"Connection lost"),t.k0s(),t.j41(4,"ion-buttons",0)(5,"ion-button",1),t.bIt("click",function(){return n.dismiss()}),t.EFF(6,"Close"),t.k0s()()()(),t.j41(7,"ion-content",2)(8,"ion-text")(9,"h4"),t.EFF(10,"I lost the connection to the server \u{1fae4}"),t.k0s(),t.j41(11,"b",3),t.EFF(12,"Maybe the server was stopped or the connection dropped."),t.k0s()()()),2&e&&(t.R7$(5),t.Y8G("strong",!0))},dependencies:[a.Jm,a.QW,a.W9,a.eU,a.IO,a.BC,a.ai]}),o})();var P=h(5312),U=h(177);function A(i,o){if(1&i){const r=t.RV6();t.j41(0,"ion-button",6),t.bIt("click",function(){t.eBV(r);const n=t.XpG();return t.Njj(n.cancel())}),t.EFF(1,"Cancel"),t.k0s()}}let D=(()=>{var i;class o{constructor(e){this.modalController=e,this.message="",this.environment=P.c}cancel(){var e=this;return(0,l.A)(function*(){var n;null===(n=e.canceled)||void 0===n||n.emit(),yield e.modalController.dismiss(null,"cancel")})()}}return(i=o).\u0275fac=function(e){return new(e||i)(t.rXU(a.W3))},i.\u0275cmp=t.VBU({type:i,selectors:[["app-connecting"]],decls:8,vars:2,consts:[[1,"ion-padding"],[1,"h-100","ion-padding","d-flex","flex-column","justify-content-center","align-items-center"],["id","message",1,"d-block","text-center","h4"],["role","status",1,"spinner-grow","mt-4"],[1,"visually-hidden"],["class","mt-5",3,"click",4,"ngIf"],[1,"mt-5",3,"click"]],template:function(e,n){1&e&&(t.j41(0,"ion-content",0)(1,"div",1)(2,"span",2),t.EFF(3),t.k0s(),t.j41(4,"div",3)(5,"span",4),t.EFF(6,"Loading..."),t.k0s()(),t.DNE(7,A,2,0,"ion-button",5),t.k0s()()),2&e&&(t.R7$(3),t.JRh(n.message),t.R7$(4),t.Y8G("ngIf",!n.environment.webVersion))},dependencies:[U.bT,a.Jm,a.W9],styles:[".spinner-grow[_ngcontent-%COMP%]{width:3em;height:3em}#message[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_text-animation .5s}@keyframes _ngcontent-%COMP%_text-animation{0%{opacity:0}1000%{opacity:100%}}"]}),o})(),T=(()=>{var i;class o{constructor(e){this.modalController=e,this.canceled=new t.bkB}dismiss(){var e=this;return(0,l.A)(function*(){try{var n;yield null===(n=e.openModal)||void 0===n?void 0:n.dismiss()}catch(s){console.error(s)}})()}showLoading(e){var n=this;return(0,l.A)(function*(){yield n.dismiss(),n.openModal=yield n.modalController.create({component:D,componentProps:{message:e,canceled:n.canceled},backdropDismiss:!1}),yield n.openModal.present()})()}}return(i=o).\u0275fac=function(e){return new(e||i)(t.KVO(a.W3))},i.\u0275prov=t.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),o})();var V=h(7709),O=h(8160),G=h(5928),y=h(3031),N=h(1083);let H=(()=>{var i;class o{constructor(e,n,s){this.macroDeckService=e,this.loadingService=n,this.router=s,this.initialConfigReceived=!1,e.interaction.subscribe(c=>{this.handleInteraction(c)})}handleMessage(e){var n=this;return(0,l.A)(function*(){if(e.Method)switch(e.Method){case"GET_CONFIG":n.macroDeckService.setConfig(e),n.initialConfigReceived||(n.initialConfigReceived=!0,yield n.router.navigate(["deck"],{replaceUrl:!1,skipLocationChange:!0}),yield n.loadingService.dismiss()),n.send(S.getGetButtonsMessage());break;case"GET_BUTTONS":if(!n.initialConfigReceived)return;let s=e.Buttons.map(b=>n.mapProtocol2ButtonToWidget(b));n.macroDeckService.setWidgets(s);break;case"UPDATE_BUTTON":if(!n.initialConfigReceived)return;let c=n.mapProtocol2ButtonToWidget(e.Buttons[0]);n.macroDeckService.updateWidget(c);break;case"UPDATE_LABEL":if(!n.initialConfigReceived)return;let d=e.Buttons[0],u=n.macroDeckService.widgets.find(b=>b.row===d.Position_Y&&b.column===d.Position_X);if(void 0===u)return;(null==u?void 0:u.widgetContent).labelBase64=d.LabelBase64,n.macroDeckService.updateWidget(u)}})()}setWebsocketSubject(e){this.initialConfigReceived=!1,this.socket=e}mapProtocol2ButtonToWidget(e){return{backgroundColorHex:e.BackgroundColorHex,colSpan:1,column:e.Position_X,row:e.Position_Y,rowSpan:1,widgetContentType:G.G.button,widgetContent:{iconBase64:e.IconBase64,labelBase64:e.LabelBase64}}}send(e){var n;null===(n=this.socket)||void 0===n||n.next(e)}handleInteraction(e){let n;switch(e.widgetInteractionType){case y.Z.ButtonPress:n="BUTTON_PRESS";break;case y.Z.ButtonShortPressRelease:n="BUTTON_RELEASE";break;case y.Z.ButtonLongPress:n="BUTTON_LONG_PRESS";break;case y.Z.ButtonLongPressRelease:n="BUTTON_LONG_PRESS_RELEASE"}this.send({Method:n,Message:"".concat(e.widget.row,"_").concat(e.widget.column)})}}return(i=o).\u0275fac=function(e){return new(e||i)(t.KVO(N.j),t.KVO(T),t.KVO(O.Ix))},i.\u0275prov=t.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),o})(),$=(()=>{var i;class o{constructor(e){this.protocol2Service=e,this.protocolVersion=2}handleMessage(e){var n=this;return(0,l.A)(function*(){2===n.protocolVersion&&(yield n.protocol2Service.handleMessage(e))})()}setWebsocketSubject(e){this.protocol2Service.setWebsocketSubject(e)}}return(i=o).\u0275fac=function(e){return new(e||i)(t.KVO(H))},i.\u0275prov=t.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),o})(),K=(()=>{var i;class o{constructor(e,n,s,c,d){this.loadingService=e,this.modalController=n,this.settingsService=s,this.router=c,this.protocolHandlerService=d,this.isConnected=!1,this.connecting=!1,this.closing=!1,this.url="",this.connectionClosed=new m.B,this.connectionOpened=new m.B,this.connectionLost=new t.bkB,this.connected=new t.bkB,this.closed=new t.bkB,this.subscription=new k.yU,this.subscribeOpenClose()}reconnect(){var e=this;return(0,l.A)(function*(){yield e.connectToString(e.url)})()}connectToString(e){var n=this;return(0,l.A)(function*(){var s;n.url=e,n.closing=!1,yield n.loadingService.showLoading("Connecting to ".concat(n.url,"...")),n.socket=function M(i){return new B(i)}({url:n.url,closeObserver:n.connectionClosed,openObserver:n.connectionOpened}),n.subscription.add(n.loadingService.canceled.subscribe(()=>{n.close()})),n.subscription=n.socket.subscribe({next:(s=(0,l.A)(function*(c){yield n.protocolHandlerService.handleMessage(c)}),function(d){return s.apply(this,arguments)}),error:function(){var s=(0,l.A)(function*(c){yield n.loadingService.dismiss(),n.closed.emit(),n.connecting=!1,c instanceof DOMException&&"SecurityError"===c.name&&(yield n.showInsecureConnectionModal())});return function(d){return s.apply(this,arguments)}}()})})()}connect(e,n,s,c){var d=this;return(0,l.A)(function*(){d.connecting||d.isConnected||(yield d.connectToString((s?"wss://":"ws://")+e+":"+n),d.connectionId=c)})()}subscribeOpenClose(){var e=this;this.connectionClosed.subscribe(function(){var n=(0,l.A)(function*(s){console.info("Closed with code "+s.code),yield e.loadingService.dismiss(),e.subscription.unsubscribe(),e.closed.emit(),e.connecting=!1,e.closing||(yield e.handleError(s)),e.isConnected=!1,yield e.router.navigate([""],{replaceUrl:!1,skipLocationChange:!0})});return function(s){return n.apply(this,arguments)}}()),this.connectionOpened.subscribe((0,l.A)(function*(){var n,s;e.connected.emit(),e.connecting=!1,yield e.settingsService.increaseConnectionCount(),yield e.settingsService.setLastConnection(null!==(n=e.connectionId)&&void 0!==n?n:""),e.protocolHandlerService.setWebsocketSubject(e.socket),e.isConnected=!0,yield e.loadingService.showLoading("Waiting for the host to accept the connection...");let c=yield e.settingsService.getClientId();null===(s=e.socket)||void 0===s||s.next(S.getConnectedMessage(c))}))}close(){var e;console.log("Close requested"),this.closing=!0,null===(e=this.socket)||void 0===e||e.complete(),this.subscription.unsubscribe(),this.connectionId=void 0}send(e){var n;null===(n=this.socket)||void 0===n||n.next(e)}handleError(e){var n=this;return(0,l.A)(function*(){if(1e3==e.code)return;if(P.c.webVersion)return void n.connectionLost.emit();if(n.isConnected)return void(yield n.showConnectionLostModal());let s="Code: ".concat(e.code,"\nReason: ").concat(e.reason,"\nWas clean: ").concat(e.wasClean);yield n.showConnectionFailedModal(s)})()}showConnectionFailedModal(e){var n=this;return(0,l.A)(function*(){yield(yield n.modalController.create({component:_,componentProps:{url:n.url,errorInformation:e}})).present()})()}showInsecureConnectionModal(){var e=this;return(0,l.A)(function*(){yield(yield e.modalController.create({component:f})).present()})()}showConnectionLostModal(){var e=this;return(0,l.A)(function*(){yield(yield e.modalController.create({component:R})).present()})()}}return(i=o).\u0275fac=function(e){return new(e||i)(t.KVO(T),t.KVO(a.W3),t.KVO(V.h),t.KVO(O.Ix),t.KVO($))},i.\u0275prov=t.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),o})()}}]);