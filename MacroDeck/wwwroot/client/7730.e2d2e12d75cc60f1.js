"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7730],{7730:(K,v,a)=>{a.r(v),a.d(v,{DeckPageModule:()=>N});var g=a(6814),_=a(95),d=a(9843),f=a(5877),p=a(5861),P=a(4373),k=a(553),t=a(9468),W=a(5015);let T=(()=>{var i;class o{constructor(e){this.platform=e,this.setCurrentPlatform()}isNative(){return"native"===this._currentPlatform}isBrowser(){return"browser"===this._currentPlatform}setCurrentPlatform(){this._currentPlatform=this.platform.is("ios")||this.platform.is("android")&&!this.platform.is("desktop")&&!this.platform.is("mobileweb")?"mobile":"browser"}}return(i=o).\u0275fac=function(e){return new(e||i)(t.LFG(d.t4))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),o})();var C=a(7394),w=a(4625),y=a(231);const D=["widgetsWrapper"];function M(i,o){if(1&i&&(t.TgZ(0,"div",3),t._UZ(1,"app-widget-content",4),t.qZA()),2&i){const r=o.index,e=t.oxw();t.Q6J("ngStyle",e.getWidgetStyle(r)),t.xp6(1),t.Q6J("ngStyle",e.getWidgetContentStyle())("data",e.getWidgetFromIndex(r))}}const x=function(){return[]};let m=(()=>{var i;class o{constructor(e,n){this.macroDeckService=e,this.applicationRef=n,this.subscription=new C.w0,this.buttonSize=0,this.widgetSpacingPoints=0,this.wrapperWidth=0,this.wrapperHeight=0,this.wrapperPaddingX=0,this.wrapperPaddingY=0}ngOnDestroy(){this.subscription.unsubscribe()}ngAfterContentInit(){this.subscription.add(this.macroDeckService.configUpdate.subscribe(()=>{this.calculateWidgetSize(),this.applicationRef.tick()})),this.subscription.add(screen.orientation.onchange=()=>{setTimeout(()=>{this.calculateWidgetSize(),this.applicationRef.tick()},100)}),setTimeout(()=>{this.calculateWidgetSize()},1e3)}calculateWidgetSize(){var e,n,s,c;if(null==this.wrapperElement)return;const l=window.getComputedStyle(this.wrapperElement.nativeElement,null);this.wrapperPaddingX=parseInt(l.getPropertyValue("padding-left"))+parseInt(l.getPropertyValue("padding-right")),this.wrapperPaddingY=parseInt(l.getPropertyValue("padding-top"))+parseInt(l.getPropertyValue("padding-bottom")),this.wrapperWidth=(null!==(e=null===(n=this.wrapperElement)||void 0===n?void 0:n.nativeElement.offsetWidth)&&void 0!==e?e:0)-this.wrapperPaddingX,this.wrapperHeight=(null!==(s=null===(c=this.wrapperElement)||void 0===c?void 0:c.nativeElement.offsetHeight)&&void 0!==s?s:0)-this.wrapperPaddingY,this.buttonSize=Math.min(this.wrapperWidth/this.macroDeckService.columns,this.wrapperHeight/this.macroDeckService.rows),this.widgetSpacingPoints=this.macroDeckService.buttonSpacing/100*this.buttonSize*72/96/2,o.borderRadiusPoints=this.macroDeckService.buttonRadius/100*this.buttonSize*72/96/2}countTotalWidgets(){return this.macroDeckService.rows*this.macroDeckService.columns}getWidgetStyle(e){var n,s;const c=Math.trunc(e/this.macroDeckService.columns),l=Math.trunc(e%this.macroDeckService.columns),u=this.macroDeckService.widgets.find(S=>S.row==c&&S.column==l);return{width:this.buttonSize*(null!==(n=null==u?void 0:u.colSpan)&&void 0!==n?n:1)+"px",height:this.buttonSize*(null!==(s=null==u?void 0:u.rowSpan)&&void 0!==s?s:1)+"px",position:"absolute",top:this.wrapperHeight/2-this.macroDeckService.rows*this.buttonSize/2+c*this.buttonSize+"px",left:this.wrapperWidth/2-this.macroDeckService.columns*this.buttonSize/2+l*this.buttonSize+"px"}}getWidgetContentStyle(){return{margin:this.widgetSpacingPoints+"pt"}}getWidgetFromIndex(e){const n=Math.trunc(e/this.macroDeckService.columns),s=Math.trunc(e%this.macroDeckService.columns);let c=this.macroDeckService.widgets.find(l=>l.row==n&&l.column==s);return c||(c={backgroundColorHex:"#232323",colSpan:1,column:s,row:n,rowSpan:1,widgetContent:void 0,widgetContentType:w.k.empty}),c}}return(i=o).borderRadiusPoints=0,i.\u0275fac=function(e){return new(e||i)(t.Y36(y.a),t.Y36(t.z2F))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-widget-grid"]],viewQuery:function(e,n){if(1&e&&t.Gf(D,5),2&e){let s;t.iGM(s=t.CRH())&&(n.wrapperElement=s.first)}},hostBindings:function(e,n){1&e&&t.NdJ("resize",function(c){return n.calculateWidgetSize(c)},!1,t.Jf7)},decls:3,vars:2,consts:[[1,"widgets-wrapper","bg-macro-deck"],["widgetsWrapper",""],["class","widget",3,"ngStyle",4,"ngFor","ngForOf"],[1,"widget",3,"ngStyle"],[1,"widget-content-wrapper",3,"ngStyle","data"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0,1),t.YNc(2,M,2,3,"div",2),t.qZA()),2&e&&(t.xp6(2),t.Q6J("ngForOf",t.DdM(1,x).constructor(n.countTotalWidgets())))},styles:[".widgets-wrapper[_ngcontent-%COMP%]{width:inherit;height:inherit;margin:0;padding:0;position:relative;z-index:0;border-radius:inherit}.widget[_ngcontent-%COMP%]{display:flex;overflow:visible;touch-action:none}.widget-content-wrapper[_ngcontent-%COMP%]{display:flex;position:absolute;align-items:stretch;top:0;bottom:0;left:0;right:0;overflow:hidden;transition:all .2s ease-out;cursor:pointer;border-radius:inherit}.widget-content-wrapper[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1}"]}),o})();function z(i,o){if(1&i){const r=t.EpF();t.TgZ(0,"ion-fab-button",10),t.NdJ("click",function(){t.CHM(r);const n=t.oxw();return t.KtG(n.close())}),t._UZ(1,"ion-icon",11),t.qZA()}}function I(i,o){if(1&i){const r=t.EpF();t.TgZ(0,"ion-fab-button",7),t.NdJ("click",function(){t.CHM(r);const n=t.oxw();return t.KtG(n.openFullscreen())}),t._UZ(1,"ion-icon",12),t.qZA()}}const Z=[{path:"",component:(()=>{var i;class o{constructor(e,n,s,c){this.websocketService=e,this.router=n,this.currentPlatformService=s,this.modalController=c,this.showFullscreenButton=!0,this.environment=k.N}ngOnInit(){this.showFullscreenButton=this.currentPlatformService.isBrowser()}ngAfterViewInit(){var e=this;return(0,p.Z)(function*(){e.websocketService.isConnected||(yield e.router.navigate([""],{replaceUrl:!0}))})()}close(){var e=this;return(0,p.Z)(function*(){e.websocketService.close()})()}openSettings(){var e=this;return(0,p.Z)(function*(){yield(yield e.modalController.create({component:P.g})).present()})()}openFullscreen(){const e=document.documentElement;e.requestFullscreen&&e.requestFullscreen().then()}}return(i=o).\u0275fac=function(e){return new(e||i)(t.Y36(W.i),t.Y36(f.F0),t.Y36(T),t.Y36(d.IN))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-deck"]],decls:10,vars:5,consts:[[3,"scrollY","scrollX","fullscreen"],[1,"widgets-grid-container"],["slot","fixed","vertical","bottom","horizontal","start",1,"fab-menu"],["size","small"],["name","ellipsis-vertical"],["side","top"],["color","danger",3,"click",4,"ngIf"],[3,"click"],["name","settings"],[3,"click",4,"ngIf"],["color","danger",3,"click"],["name","close"],["name","expand"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-content",0),t._UZ(1,"app-widget-grid",1),t.TgZ(2,"ion-fab",2)(3,"ion-fab-button",3),t._UZ(4,"ion-icon",4),t.qZA(),t.TgZ(5,"ion-fab-list",5),t.YNc(6,z,2,0,"ion-fab-button",6),t.TgZ(7,"ion-fab-button",7),t.NdJ("click",function(){return n.openSettings()}),t._UZ(8,"ion-icon",8),t.qZA(),t.YNc(9,I,2,0,"ion-fab-button",9),t.qZA()()()),2&e&&(t.Q6J("scrollY",!1)("scrollX",!1)("fullscreen",!0),t.xp6(6),t.Q6J("ngIf",!n.environment.webVersion),t.xp6(3),t.Q6J("ngIf",n.showFullscreenButton))},dependencies:[g.O5,d.W2,d.IJ,d.W4,d.zq,d.gu,m],styles:[".widgets-grid-container[_ngcontent-%COMP%]{width:100%;height:100%}.fab-menu[_ngcontent-%COMP%]{opacity:.9}"]}),o})()}];let B=(()=>{var i;class o{}return(i=o).\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[f.Bz.forChild(Z),f.Bz]}),o})();var h=a(4260),O=a(6593),F=a(3660);function J(i,o){if(1&i&&t._UZ(0,"img",4),2&i){const r=t.oxw();t.Q6J("src",r.foregroundImage,t.LSH)}}function Q(i,o){if(1&i&&t._UZ(0,"img",5),2&i){const r=t.oxw();t.Q6J("src",r.iconImage,t.LSH)}}const Y=function(i,o){return{"border-radius":i,border:o,padding:"2pt"}};let E=(()=>{var i;class o{constructor(e,n,s,c){this.renderer=e,this.macroDeckService=n,this.sanitizer=s,this.settingsService=c,this.widgetGridComponent=m,this.longPressTrigger=!1}updateWidget(e){this.widget=e;const n=e.widgetContent;this.foregroundImage=null!=n&&n.labelBase64?this.sanitizer.bypassSecurityTrustResourceUrl("data:image/jpg;base64,"+(null==n?void 0:n.labelBase64)):void 0,this.iconImage=null!=n&&n.iconBase64?this.sanitizer.bypassSecurityTrustResourceUrl("data:image/jpg;base64,"+(null==n?void 0:n.iconBase64)):void 0,this.backgroundStyle={"background-color":e.backgroundColorHex},this.borderColor=e.backgroundColorHex?this.adjustColor(e.backgroundColorHex,-40):void 0}onMouseUp(e){if(this.setClass(e.currentTarget,"pressed",!1),this.setClass(e.currentTarget,"release-transition",!0),this.longPressTrigger){if(void 0===this.widget)return;this.emitInteraction(h.Q.ButtonLongPressRelease)}else this.emitInteraction(h.Q.ButtonShortPressRelease);this.longPressTrigger=!1,clearTimeout(this.longPressTimeout)}onMouseDown(e){var n=this;return(0,p.Z)(function*(){n.setClass(e.currentTarget,"pressed",!0),n.setClass(e.currentTarget,"release-transition",!1),n.emitInteraction(h.Q.ButtonPress);let s=yield n.settingsService.getButtonLongPressDelay();setTimeout(()=>{}),n.longPressTimeout=setTimeout(()=>{n.longPressTrigger=!0,n.emitInteraction(h.Q.ButtonLongPress)},s)})()}setClass(e,n,s){const c=e.classList.contains(n);s&&!c?this.renderer.addClass(e,n):!s&&c&&this.renderer.removeClass(e,n)}adjustColor(e,n){return"#"+e.replace(/^#/,"").replace(/../g,s=>("0"+Math.min(255,Math.max(0,parseInt(s,16)+n)).toString(16)).substr(-2))}emitInteraction(e){void 0!==this.widget&&this.macroDeckService.interaction.emit({widget:this.widget,widgetInteractionType:e})}}return(i=o).\u0275fac=function(e){return new(e||i)(t.Y36(t.Qsj),t.Y36(y.a),t.Y36(O.H7),t.Y36(F.g))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-button-widget"]],decls:4,vars:7,consts:[[1,"button-widget-wrapper",3,"ngStyle","down","up"],["class","foreground",3,"src",4,"ngIf"],["class","icon",3,"src",4,"ngIf"],[1,"background",3,"ngStyle"],[1,"foreground",3,"src"],[1,"icon",3,"src"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.NdJ("down",function(c){return n.onMouseDown(c)})("up",function(c){return n.onMouseUp(c)}),t.YNc(1,J,1,1,"img",1),t.YNc(2,Q,1,1,"img",2),t._UZ(3,"div",3),t.qZA()),2&e&&(t.Q6J("ngStyle",t.WLB(4,Y,n.widgetGridComponent.borderRadiusPoints+"pt","2pt solid "+n.borderColor)),t.xp6(1),t.Q6J("ngIf",n.foregroundImage),t.xp6(1),t.Q6J("ngIf",n.iconImage),t.xp6(1),t.Q6J("ngStyle",n.backgroundStyle))},dependencies:[g.PC,g.O5],styles:[".button-widget-wrapper[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:hidden;border-radius:inherit;transition:all .01s linear;box-sizing:border-box}.foreground[_ngcontent-%COMP%], .icon[_ngcontent-%COMP%], .background[_ngcontent-%COMP%]{background-size:cover;background-repeat:no-repeat;background-position:center;position:absolute;height:100%;width:100%;object-fit:fill;top:0;right:0;bottom:0;left:0;transition:background-color .3s ease-out;transform:translateZ(0);-webkit-backface-visibility:hidden;-moz-backface-visibility:hidden;-ms-backface-visibility:hidden}.background[_ngcontent-%COMP%]{z-index:1}.icon[_ngcontent-%COMP%]{z-index:2}.foreground[_ngcontent-%COMP%]{z-index:3}.pressed[_ngcontent-%COMP%]{transform:scale(.7)}.release-transition[_ngcontent-%COMP%]{transition:transform .4s linear}"]}),o})();const H=function(i){return{"border-radius":i}};let R=(()=>{var i;class o{constructor(){this.WidgetGridComponent=m}updateWidget(e){this.backgroundStyle={"background-color":e.backgroundColorHex}}}return(i=o).\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-empty-widget"]],decls:2,vars:4,consts:[[1,"empty-widget-wrapper",3,"ngStyle"],[1,"background",3,"ngStyle"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"div",1),t.qZA()),2&e&&(t.Q6J("ngStyle",t.VKq(2,H,n.WidgetGridComponent.borderRadiusPoints+"pt")),t.xp6(1),t.Q6J("ngStyle",n.backgroundStyle))},dependencies:[g.PC],styles:[".empty-widget-wrapper[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:hidden;border-radius:inherit;transition:all .1s ease-out}.background[_ngcontent-%COMP%]{background-size:cover;background-repeat:no-repeat;background-position:center;position:absolute;top:0;right:0;bottom:0;left:0}.background[_ngcontent-%COMP%]{z-index:1}"]}),o})();const G=["contentRef"];function U(i,o){}let A=(()=>{var i;class o{set data(e){this.updateContent(e)}constructor(){this.subscription=new C.w0,this.componentCreated=!1}updateContent(e){var n;if((null==e?void 0:e.widgetContentType)!==this.currentContentType&&(null===(n=this.vcr)||void 0===n||n.clear(),this.componentCreated=!1),void 0!==this.vcr&&void 0!==e){switch(this.currentContentType=e.widgetContentType,e.widgetContentType){case w.k.empty:this.componentCreated||(this.ref=this.vcr.createComponent(R)),this.ref.instance.updateWidget(e);break;case w.k.button:this.componentCreated||(this.ref=this.vcr.createComponent(E)),this.ref.instance.updateWidget(e)}this.componentCreated=!0,this.ref.location.nativeElement.setAttribute("class","flex-grow-1")}}ngOnDestroy(){this.subscription.unsubscribe()}}return(i=o).\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-widget-content"]],viewQuery:function(e,n){if(1&e&&t.Gf(G,5,t.s_b),2&e){let s;t.iGM(s=t.CRH())&&(n.vcr=s.first)}},inputs:{data:"data"},decls:2,vars:0,consts:[["contentRef",""]],template:function(e,n){1&e&&t.YNc(0,U,0,0,"ng-template",null,0,t.W1O)}}),o})(),N=(()=>{var i;class o{}return(i=o).\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[g.ez,_.u5,d.Pc,B]}),o})();t.B6R(m,[g.sg,g.PC,A],[])}}]);