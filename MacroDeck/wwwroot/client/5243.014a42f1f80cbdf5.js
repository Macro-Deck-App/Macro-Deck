"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5243],{4625:(B,C,u)=>{u.d(C,{k:()=>l});var l=function(e){return e[e.empty=0]="empty",e[e.button=100]="button",e}(l||{})},4260:(B,C,u)=>{u.d(C,{Q:()=>l});var l=function(e){return e[e.ButtonPress=1e3]="ButtonPress",e[e.ButtonShortPressRelease=1001]="ButtonShortPressRelease",e[e.ButtonLongPress=1010]="ButtonLongPress",e[e.ButtonLongPressRelease=1011]="ButtonLongPressRelease",e}(l||{})},4373:(B,C,u)=>{u.d(C,{g:()=>g});var l=u(5861),e=u(9468),s=u(9843),w=u(3660),T=u(1414),p=u(95);let g=(()=>{var m;class M{constructor(d,_,S,k){this.modalController=d,this.settingsService=_,this.wakelockService=S,this.alertController=k,this.preventScreenTimeout=!1}ngOnInit(){var d=this;return(0,l.Z)(function*(){yield d.loadCurrentSettings()})()}confirm(){var d=this;return(0,l.Z)(function*(){yield d.saveSettings(),yield d.modalController.dismiss(null,"confirm")})()}cancel(){var d=this;return(0,l.Z)(function*(){yield d.modalController.dismiss(null,"cancel")})()}saveSettings(){var d=this;return(0,l.Z)(function*(){yield d.settingsService.setWakeLockEnabled(d.preventScreenTimeout),yield d.wakelockService.updateWakeLock()})()}loadCurrentSettings(){var d=this;return(0,l.Z)(function*(){d.preventScreenTimeout=yield d.settingsService.getWakeLockEnabled()})()}preventScreenTimeoutChange(d){var _=this;return(0,l.Z)(function*(){!0===d&&(yield(yield _.alertController.create({header:"Warning",message:"Displaying a static image for a long time can cause screen burn-in on some screens.",buttons:["OK"]})).present())})()}}return(m=M).\u0275fac=function(d){return new(d||m)(e.Y36(s.IN),e.Y36(w.g),e.Y36(T.$),e.Y36(s.Br))},m.\u0275cmp=e.Xpm({type:m,selectors:[["app-settings-modal"]],decls:16,vars:2,consts:[["slot","start"],[3,"click"],["slot","end"],[3,"strong","click"],["name","timer","slot","start"],[3,"ngModel","ngModelChange"]],template:function(d,_){1&d&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),e.NdJ("click",function(){return _.cancel()}),e._uU(4,"Cancel"),e.qZA()(),e.TgZ(5,"ion-title"),e._uU(6,"Settings"),e.qZA(),e.TgZ(7,"ion-buttons",2)(8,"ion-button",3),e.NdJ("click",function(){return _.confirm()}),e._uU(9,"Save"),e.qZA()()()(),e.TgZ(10,"ion-content")(11,"ion-list")(12,"ion-item"),e._UZ(13,"ion-icon",4),e.TgZ(14,"ion-toggle",5),e.NdJ("ngModelChange",function(k){return _.preventScreenTimeoutChange(k)})("ngModelChange",function(k){return _.preventScreenTimeout=k}),e._uU(15,"Prevent screen timeout"),e.qZA()()()()),2&d&&(e.xp6(8),e.Q6J("strong",!0),e.xp6(6),e.Q6J("ngModel",_.preventScreenTimeout))},dependencies:[s.YG,s.Sm,s.W2,s.Gu,s.gu,s.Ie,s.q_,s.wd,s.ho,s.sr,s.w,p.JJ,p.On]}),M})()},231:(B,C,u)=>{u.d(C,{a:()=>e});var l=u(9468);let e=(()=>{var s;class w{constructor(){this.configUpdate=new l.vpe,this.interaction=new l.vpe,this.widgets=[],this.rows=3,this.columns=5,this.buttonSpacing=10,this.buttonRadius=40,this.buttonBackground=!0}setConfig(p){this.rows=p.Rows,this.columns=p.Columns,this.buttonSpacing=p.ButtonSpacing,this.buttonRadius=p.ButtonRadius,this.buttonBackground=p.ButtonBackground,this.configUpdate.emit()}setWidgets(p){this.widgets=p}updateWidget(p){let g=this.widgets.findIndex(m=>m.row==p.row&&m.column==p.column);-1!==g?this.widgets[g]=p:this.widgets.push(p)}}return(s=w).\u0275fac=function(p){return new(p||s)},s.\u0275prov=l.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),w})()},5015:(B,C,u)=>{u.d(C,{i:()=>N});var l=u(5861),e=u(9468),s=u(9843);let w=(()=>{var i;class o{constructor(t){this.modalController=t,this.url=""}ngOnInit(){}dismiss(){var t=this;return(0,l.Z)(function*(){yield t.modalController.dismiss()})()}}return(i=o).\u0275fac=function(t){return new(t||i)(e.Y36(s.IN))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-connection-failed"]],decls:30,vars:2,consts:[["slot","end"],[3,"strong","click"],[1,"ion-padding"],[1,"d-block","mt-3"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e._uU(3,"Connection failed"),e.qZA(),e.TgZ(4,"ion-buttons",0)(5,"ion-button",1),e.NdJ("click",function(){return n.dismiss()}),e._uU(6,"Close"),e.qZA()()()(),e.TgZ(7,"ion-content",2)(8,"ion-text")(9,"h4"),e._uU(10),e.qZA(),e.TgZ(11,"b",3),e._uU(12,"There can be multiple reasons why this happens:"),e.qZA(),e.TgZ(13,"ul")(14,"li"),e._uU(15,"Your anti virus software or firewall blocks Macro Deck (Common issue)"),e.qZA(),e.TgZ(16,"li"),e._uU(17,"The wrong network adapter is chosen in the settings on the PC app"),e.qZA(),e.TgZ(18,"li"),e._uU(19,"The chosen port is used by another application"),e.qZA(),e.TgZ(20,"li"),e._uU(21,"Your computer and this device are not in the same network"),e.qZA(),e.TgZ(22,"li"),e._uU(23,"If you're using VPN services, disable them"),e.qZA(),e.TgZ(24,"li"),e._uU(25,"A restart of your computer can help sometimes"),e.qZA(),e.TgZ(26,"li"),e._uU(27,"If you're using a 5GHz Wi-Fi connection, try to switch to 2,4GHz temporarily"),e.qZA(),e.TgZ(28,"li"),e._uU(29,"Some routers block the communication between Ethernet and Wi-Fi. Check your router settings. Look for SSID isolation or AP isolation and disable it."),e.qZA()()()()),2&t&&(e.xp6(5),e.Q6J("strong",!0),e.xp6(5),e.hij("I was not able to connect to ",n.url," \u{1f641}"))},dependencies:[s.YG,s.Sm,s.W2,s.Gu,s.yW,s.wd,s.sr]}),o})();class T{static getConnectedMessage(o){return{Method:"CONNECTED","Client-Id":o,API:"20","Device-Type":"Web"}}static getGetButtonsMessage(){return{Method:"GET_BUTTONS"}}}let p=(()=>{var i;class o{constructor(t){this.modalController=t}ngOnInit(){}dismiss(){var t=this;return(0,l.Z)(function*(){yield t.modalController.dismiss()})()}}return(i=o).\u0275fac=function(t){return new(t||i)(e.Y36(s.IN))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-insecure-connection"]],decls:17,vars:1,consts:[["slot","end"],[3,"strong","click"],[1,"ion-padding"],[1,"d-block","mt-3"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e._uU(3,"Connection failed"),e.qZA(),e.TgZ(4,"ion-buttons",0)(5,"ion-button",1),e.NdJ("click",function(){return n.dismiss()}),e._uU(6,"Close"),e.qZA()()()(),e.TgZ(7,"ion-content",2)(8,"ion-text")(9,"h4"),e._uU(10,"I was able to connect but there were some problems \u26a0\ufe0f"),e.qZA(),e.TgZ(11,"span",3),e._uU(12," It seems like your browser blocks the connection because of security issues."),e._UZ(13,"br"),e._uU(14," This is caused by the client being accessed over a https connection and the server is not accessed wss."),e._UZ(15,"br"),e._uU(16," To solve this, allow insecure connections from https in your browser. "),e.qZA()()()),2&t&&(e.xp6(5),e.Q6J("strong",!0))},dependencies:[s.YG,s.Sm,s.W2,s.Gu,s.yW,s.wd,s.sr]}),o})();var g=u(8645),m=u(305),M=u(5592),P=u(7394),d=u(4552);class _ extends g.x{constructor(o=1/0,c=1/0,t=d.l){super(),this._bufferSize=o,this._windowTime=c,this._timestampProvider=t,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=c===1/0,this._bufferSize=Math.max(1,o),this._windowTime=Math.max(1,c)}next(o){const{isStopped:c,_buffer:t,_infiniteTimeWindow:n,_timestampProvider:r,_windowTime:a}=this;c||(t.push(o),!n&&t.push(r.now()+a)),this._trimBuffer(),super.next(o)}_subscribe(o){this._throwIfClosed(),this._trimBuffer();const c=this._innerSubscribe(o),{_infiniteTimeWindow:t,_buffer:n}=this,r=n.slice();for(let a=0;a<r.length&&!o.closed;a+=t?1:2)o.next(r[a]);return this._checkFinalizedStatuses(o),c}_trimBuffer(){const{_bufferSize:o,_timestampProvider:c,_buffer:t,_infiniteTimeWindow:n}=this,r=(n?1:2)*o;if(o<1/0&&r<t.length&&t.splice(0,t.length-r),!n){const a=c.now();let f=0;for(let h=1;h<t.length&&t[h]<=a;h+=2)f=h;f&&t.splice(0,f+1)}}}const S={url:"",deserializer:i=>JSON.parse(i.data),serializer:i=>JSON.stringify(i)};class E extends g.u{constructor(o,c){if(super(),this._socket=null,o instanceof M.y)this.destination=c,this.source=o;else{const t=this._config=Object.assign({},S);if(this._output=new g.x,"string"==typeof o)t.url=o;else for(const n in o)o.hasOwnProperty(n)&&(t[n]=o[n]);if(!t.WebSocketCtor&&WebSocket)t.WebSocketCtor=WebSocket;else if(!t.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new _}}lift(o){const c=new E(this._config,this.destination);return c.operator=o,c.source=this,c}_resetState(){this._socket=null,this.source||(this.destination=new _),this._output=new g.x}multiplex(o,c,t){const n=this;return new M.y(r=>{try{n.next(o())}catch(f){r.error(f)}const a=n.subscribe({next:f=>{try{t(f)&&r.next(f)}catch(h){r.error(h)}},error:f=>r.error(f),complete:()=>r.complete()});return()=>{try{n.next(c())}catch(f){r.error(f)}a.unsubscribe()}})}_connectSocket(){const{WebSocketCtor:o,protocol:c,url:t,binaryType:n}=this._config,r=this._output;let a=null;try{a=c?new o(t,c):new o(t),this._socket=a,n&&(this._socket.binaryType=n)}catch(h){return void r.error(h)}const f=new P.w0(()=>{this._socket=null,a&&1===a.readyState&&a.close()});a.onopen=h=>{const{_socket:v}=this;if(!v)return a.close(),void this._resetState();const{openObserver:y}=this._config;y&&y.next(h);const U=this.destination;this.destination=m.Lv.create(b=>{if(1===a.readyState)try{const{serializer:Z}=this._config;a.send(Z(b))}catch(Z){this.destination.error(Z)}},b=>{const{closingObserver:Z}=this._config;Z&&Z.next(void 0),b&&b.code?a.close(b.code,b.reason):r.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),this._resetState()},()=>{const{closingObserver:b}=this._config;b&&b.next(void 0),a.close(),this._resetState()}),U&&U instanceof _&&f.add(U.subscribe(this.destination))},a.onerror=h=>{this._resetState(),r.error(h)},a.onclose=h=>{a===this._socket&&this._resetState();const{closeObserver:v}=this._config;v&&v.next(h),h.wasClean?r.complete():r.error(h)},a.onmessage=h=>{try{const{deserializer:v}=this._config;r.next(v(h))}catch(v){r.error(v)}}}_subscribe(o){const{source:c}=this;return c?c.subscribe(o):(this._socket||this._connectSocket(),this._output.subscribe(o),o.add(()=>{const{_socket:t}=this;0===this._output.observers.length&&(t&&(1===t.readyState||0===t.readyState)&&t.close(),this._resetState())}),o)}unsubscribe(){const{_socket:o}=this;o&&(1===o.readyState||0===o.readyState)&&o.close(),this._resetState(),super.unsubscribe()}}let x=(()=>{var i;class o{constructor(t){this.modalController=t}dismiss(){var t=this;return(0,l.Z)(function*(){yield t.modalController.dismiss()})()}}return(i=o).\u0275fac=function(t){return new(t||i)(e.Y36(s.IN))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-connection-lost"]],decls:13,vars:1,consts:[["slot","end"],[3,"strong","click"],[1,"ion-padding"],[1,"d-block","mt-3"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e._uU(3,"Connection lost"),e.qZA(),e.TgZ(4,"ion-buttons",0)(5,"ion-button",1),e.NdJ("click",function(){return n.dismiss()}),e._uU(6,"Close"),e.qZA()()()(),e.TgZ(7,"ion-content",2)(8,"ion-text")(9,"h4"),e._uU(10,"I lost the connection to the server \u{1fae4}"),e.qZA(),e.TgZ(11,"b",3),e._uU(12,"Maybe the server was stopped or the connection dropped."),e.qZA()()()),2&t&&(e.xp6(5),e.Q6J("strong",!0))},dependencies:[s.YG,s.Sm,s.W2,s.Gu,s.yW,s.wd,s.sr]}),o})(),I=(()=>{var i;class o{constructor(t){this.loadingController=t}dismiss(){var t=this;return(0,l.Z)(function*(){try{var n;yield null===(n=t.loadingMessage)||void 0===n?void 0:n.dismiss(),t.loadingMessage=void 0}catch(r){console.error(r)}})()}showText(t){var n=this;return(0,l.Z)(function*(){try{yield n.dismiss(),n.loadingMessage=yield n.loadingController.create({message:t}),yield n.loadingMessage.present()}catch(r){console.error(r)}})()}}return(i=o).\u0275fac=function(t){return new(t||i)(e.LFG(s.HT))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),o})();var O=u(3660),W=u(5877),A=u(4625),D=u(4260),F=u(231);let G=(()=>{var i;class o{constructor(t,n,r){this.macroDeckService=t,this.loadingService=n,this.router=r,this.initialConfigReceived=!1,t.interaction.subscribe(a=>{this.handleInteraction(a)})}handleMessage(t){var n=this;return(0,l.Z)(function*(){if(t.Method)switch(t.Method){case"GET_CONFIG":n.macroDeckService.setConfig(t),n.initialConfigReceived||(n.initialConfigReceived=!0,yield n.router.navigate(["deck"],{replaceUrl:!1,skipLocationChange:!0}),yield n.loadingService.dismiss()),n.send(T.getGetButtonsMessage());break;case"GET_BUTTONS":if(!n.initialConfigReceived)return;let r=t.Buttons.map(y=>n.mapProtocol2ButtonToWidget(y));n.macroDeckService.setWidgets(r);break;case"UPDATE_BUTTON":if(!n.initialConfigReceived)return;let a=n.mapProtocol2ButtonToWidget(t.Buttons[0]);n.macroDeckService.updateWidget(a);break;case"UPDATE_LABEL":if(!n.initialConfigReceived)return;let f=t.Buttons[0],h=n.macroDeckService.widgets.find(y=>y.row===f.Position_Y&&y.column===f.Position_X);if(void 0===h)return;(null==h?void 0:h.widgetContent).labelBase64=f.LabelBase64,n.macroDeckService.updateWidget(h)}})()}setWebsocketSubject(t){this.initialConfigReceived=!1,this.socket=t}mapProtocol2ButtonToWidget(t){return{backgroundColorHex:t.BackgroundColorHex,colSpan:1,column:t.Position_X,row:t.Position_Y,rowSpan:1,widgetContentType:A.k.button,widgetContent:{iconBase64:t.IconBase64,labelBase64:t.LabelBase64}}}send(t){var n;null===(n=this.socket)||void 0===n||n.next(t)}handleInteraction(t){t.widgetInteractionType===D.Q.ButtonPress&&this.send({Method:"BUTTON_PRESS",Message:`${t.widget.row}_${t.widget.column}`})}}return(i=o).\u0275fac=function(t){return new(t||i)(e.LFG(F.a),e.LFG(I),e.LFG(W.F0))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),o})(),R=(()=>{var i;class o{constructor(t){this.protocol2Service=t,this.protocolVersion=2}handleMessage(t){var n=this;return(0,l.Z)(function*(){2===n.protocolVersion&&(yield n.protocol2Service.handleMessage(t))})()}setWebsocketSubject(t){this.protocol2Service.setWebsocketSubject(t)}}return(i=o).\u0275fac=function(t){return new(t||i)(e.LFG(G))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),o})(),N=(()=>{var i;class o{constructor(t,n,r,a,f){this.loadingService=t,this.modalController=n,this.settingsService=r,this.router=a,this.protocolHandlerService=f,this.isConnected=!1,this.url="",this.connectionClosed=new g.x,this.connectionOpened=new g.x,this.subscribeOpenClose()}connectToString(t){var n=this;return(0,l.Z)(function*(){var r;n.url=t,yield n.loadingService.showText(`Connecting to ${n.url}...`),n.socket=function L(i){return new E(i)}({url:n.url,closeObserver:n.connectionClosed,openObserver:n.connectionOpened}),n.socket.subscribe({next:(r=(0,l.Z)(function*(a){yield n.protocolHandlerService.handleMessage(a)}),function(f){return r.apply(this,arguments)}),error:function(){var r=(0,l.Z)(function*(a){yield n.loadingService.dismiss(),a instanceof DOMException&&"SecurityError"===a.name&&(yield n.showInsecureConnectionModal())});return function(f){return r.apply(this,arguments)}}()})})()}connect(t,n,r){var a=this;return(0,l.Z)(function*(){yield a.connectToString((r?"wss://":"ws://")+t+":"+n)})()}subscribeOpenClose(){var t=this;this.connectionClosed.subscribe(function(){var n=(0,l.Z)(function*(r){switch(console.info("Closed with code "+r.code),yield t.loadingService.dismiss(),r.code){case 1e3:break;case 1005:case 1006:t.isConnected?yield t.showConnectionLostModal():yield t.showConnectionFailedModal()}t.isConnected=!1,yield t.router.navigate([""],{replaceUrl:!1,skipLocationChange:!0})});return function(r){return n.apply(this,arguments)}}()),this.connectionOpened.subscribe((0,l.Z)(function*(){var n;t.protocolHandlerService.setWebsocketSubject(t.socket),t.isConnected=!0,yield t.loadingService.showText("Waiting for the host to accept the connection...");let r=yield t.settingsService.getClientId();null===(n=t.socket)||void 0===n||n.next(T.getConnectedMessage(r))}))}close(){var t;null===(t=this.socket)||void 0===t||t.complete()}send(t){var n;null===(n=this.socket)||void 0===n||n.next(t)}showConnectionFailedModal(){var t=this;return(0,l.Z)(function*(){yield(yield t.modalController.create({component:w,componentProps:{url:t.url}})).present()})()}showInsecureConnectionModal(){var t=this;return(0,l.Z)(function*(){yield(yield t.modalController.create({component:p})).present()})()}showConnectionLostModal(){var t=this;return(0,l.Z)(function*(){yield(yield t.modalController.create({component:x})).present()})()}}return(i=o).\u0275fac=function(t){return new(t||i)(e.LFG(I),e.LFG(s.IN),e.LFG(O.g),e.LFG(W.F0),e.LFG(R))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),o})()}}]);