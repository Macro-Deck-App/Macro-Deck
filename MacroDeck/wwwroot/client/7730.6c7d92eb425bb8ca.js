"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7730],{7730:(L,v,a)=>{a.r(v),a.d(v,{DeckPageModule:()=>G});var g=a(6814),k=a(95),l=a(9843),h=a(5877),f=a(5861),_=a(4373),t=a(9468),P=a(5015);let W=(()=>{var n;class o{constructor(e){this.platform=e,this.setCurrentPlatform()}isNative(){return"native"===this._currentPlatform}isBrowser(){return"browser"===this._currentPlatform}setCurrentPlatform(){this._currentPlatform=this.platform.is("ios")||this.platform.is("android")&&!this.platform.is("desktop")&&!this.platform.is("mobileweb")?"mobile":"browser"}}return(n=o).\u0275fac=function(e){return new(e||n)(t.LFG(l.t4))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),o})();var C=a(7394),w=a(4625),y=a(231);const T=["widgetsWrapper"];function M(n,o){if(1&n&&(t.TgZ(0,"div",3),t._UZ(1,"app-widget-content",4),t.qZA()),2&n){const r=o.index,e=t.oxw();t.Q6J("ngStyle",e.getWidgetStyle(r)),t.xp6(1),t.Q6J("ngStyle",e.getWidgetContentStyle())("data",e.getWidgetFromIndex(r))}}const z=function(){return[]};let p=(()=>{var n;class o{constructor(e,i){this.macroDeckService=e,this.applicationRef=i,this.subscription=new C.w0,this.buttonSize=0,this.widgetSpacingPoints=0,this.wrapperWidth=0,this.wrapperHeight=0,this.wrapperPaddingX=0,this.wrapperPaddingY=0}ngOnDestroy(){this.subscription.unsubscribe()}ngAfterContentInit(){this.subscription.add(this.macroDeckService.configUpdate.subscribe(()=>{this.calculateWidgetSize(),this.applicationRef.tick()})),this.subscription.add(screen.orientation.onchange=()=>{setTimeout(()=>{this.calculateWidgetSize(),this.applicationRef.tick()},100)}),setTimeout(()=>{this.calculateWidgetSize()},1e3)}calculateWidgetSize(){var e,i,s,c;if(null==this.wrapperElement)return;const d=window.getComputedStyle(this.wrapperElement.nativeElement,null);this.wrapperPaddingX=parseInt(d.getPropertyValue("padding-left"))+parseInt(d.getPropertyValue("padding-right")),this.wrapperPaddingY=parseInt(d.getPropertyValue("padding-top"))+parseInt(d.getPropertyValue("padding-bottom")),this.wrapperWidth=(null!==(e=null===(i=this.wrapperElement)||void 0===i?void 0:i.nativeElement.offsetWidth)&&void 0!==e?e:0)-this.wrapperPaddingX,this.wrapperHeight=(null!==(s=null===(c=this.wrapperElement)||void 0===c?void 0:c.nativeElement.offsetHeight)&&void 0!==s?s:0)-this.wrapperPaddingY,this.buttonSize=Math.min(this.wrapperWidth/this.macroDeckService.columns,this.wrapperHeight/this.macroDeckService.rows),this.widgetSpacingPoints=this.macroDeckService.buttonSpacing/100*this.buttonSize*72/96/2,o.borderRadiusPoints=this.macroDeckService.buttonRadius/100*this.buttonSize*72/96/2}countTotalWidgets(){return this.macroDeckService.rows*this.macroDeckService.columns}getWidgetStyle(e){var i,s;const c=Math.trunc(e/this.macroDeckService.columns),d=Math.trunc(e%this.macroDeckService.columns),u=this.macroDeckService.widgets.find(S=>S.row==c&&S.column==d);return{width:this.buttonSize*(null!==(i=null==u?void 0:u.colSpan)&&void 0!==i?i:1)+"px",height:this.buttonSize*(null!==(s=null==u?void 0:u.rowSpan)&&void 0!==s?s:1)+"px",position:"absolute",top:this.wrapperHeight/2-this.macroDeckService.rows*this.buttonSize/2+c*this.buttonSize+"px",left:this.wrapperWidth/2-this.macroDeckService.columns*this.buttonSize/2+d*this.buttonSize+"px"}}getWidgetContentStyle(){return{margin:this.widgetSpacingPoints+"pt"}}getWidgetFromIndex(e){const i=Math.trunc(e/this.macroDeckService.columns),s=Math.trunc(e%this.macroDeckService.columns);let c=this.macroDeckService.widgets.find(d=>d.row==i&&d.column==s);return c||(c={backgroundColorHex:"#232323",colSpan:1,column:s,row:i,rowSpan:1,widgetContent:void 0,widgetContentType:w.k.empty}),c}}return(n=o).borderRadiusPoints=0,n.\u0275fac=function(e){return new(e||n)(t.Y36(y.a),t.Y36(t.z2F))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-widget-grid"]],viewQuery:function(e,i){if(1&e&&t.Gf(T,5),2&e){let s;t.iGM(s=t.CRH())&&(i.wrapperElement=s.first)}},hostBindings:function(e,i){1&e&&t.NdJ("resize",function(c){return i.calculateWidgetSize(c)},!1,t.Jf7)},decls:3,vars:2,consts:[[1,"widgets-wrapper","bg-macro-deck"],["widgetsWrapper",""],["class","widget",3,"ngStyle",4,"ngFor","ngForOf"],[1,"widget",3,"ngStyle"],[1,"widget-content-wrapper",3,"ngStyle","data"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0,1),t.YNc(2,M,2,3,"div",2),t.qZA()),2&e&&(t.xp6(2),t.Q6J("ngForOf",t.DdM(1,z).constructor(i.countTotalWidgets())))},styles:[".widgets-wrapper[_ngcontent-%COMP%]{width:inherit;height:inherit;margin:0;padding:0;position:relative;z-index:0;border-radius:inherit}.widget[_ngcontent-%COMP%]{display:flex;overflow:visible;touch-action:none}.widget-content-wrapper[_ngcontent-%COMP%]{display:flex;position:absolute;align-items:stretch;top:0;bottom:0;left:0;right:0;overflow:hidden;transition:all .2s ease-out;cursor:pointer;border-radius:inherit}.widget-content-wrapper[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1}"]}),o})();function D(n,o){if(1&n){const r=t.EpF();t.TgZ(0,"ion-fab-button",8),t.NdJ("click",function(){t.CHM(r);const i=t.oxw();return t.KtG(i.openFullscreen())}),t._UZ(1,"ion-icon",11),t.qZA()}}const x=[{path:"",component:(()=>{var n;class o{constructor(e,i,s,c){this.websocketService=e,this.router=i,this.currentPlatformService=s,this.modalController=c,this.showFullscreenButton=!0}ngOnInit(){this.showFullscreenButton=this.currentPlatformService.isBrowser()}ngAfterViewInit(){var e=this;return(0,f.Z)(function*(){e.websocketService.isConnected||(yield e.router.navigate([""],{replaceUrl:!0}))})()}close(){var e=this;return(0,f.Z)(function*(){e.websocketService.close()})()}openSettings(){var e=this;return(0,f.Z)(function*(){yield(yield e.modalController.create({component:_.g})).present()})()}openFullscreen(){const e=document.documentElement;e.requestFullscreen&&e.requestFullscreen().then()}}return(n=o).\u0275fac=function(e){return new(e||n)(t.Y36(P.i),t.Y36(h.F0),t.Y36(W),t.Y36(l.IN))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-deck"]],decls:11,vars:4,consts:[[3,"scrollY","scrollX","fullscreen"],[1,"widgets-grid-container"],["slot","fixed","vertical","bottom","horizontal","start",1,"fab-menu"],["size","small"],["name","ellipsis-vertical"],["side","top"],["color","danger",3,"click"],["name","close"],[3,"click"],["name","settings"],[3,"click",4,"ngIf"],["name","expand"]],template:function(e,i){1&e&&(t.TgZ(0,"ion-content",0),t._UZ(1,"app-widget-grid",1),t.TgZ(2,"ion-fab",2)(3,"ion-fab-button",3),t._UZ(4,"ion-icon",4),t.qZA(),t.TgZ(5,"ion-fab-list",5)(6,"ion-fab-button",6),t.NdJ("click",function(){return i.close()}),t._UZ(7,"ion-icon",7),t.qZA(),t.TgZ(8,"ion-fab-button",8),t.NdJ("click",function(){return i.openSettings()}),t._UZ(9,"ion-icon",9),t.qZA(),t.YNc(10,D,2,0,"ion-fab-button",10),t.qZA()()()),2&e&&(t.Q6J("scrollY",!1)("scrollX",!1)("fullscreen",!0),t.xp6(10),t.Q6J("ngIf",i.showFullscreenButton))},dependencies:[g.O5,l.W2,l.IJ,l.W4,l.zq,l.gu,p],styles:[".widgets-grid-container[_ngcontent-%COMP%]{width:100%;height:100%}.fab-menu[_ngcontent-%COMP%]{opacity:.9}"]}),o})()}];let I=(()=>{var n;class o{}return(n=o).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[h.Bz.forChild(x),h.Bz]}),o})();var m=a(4260),Z=a(6593);function B(n,o){if(1&n&&t._UZ(0,"img",4),2&n){const r=t.oxw();t.Q6J("src",r.foregroundImage,t.LSH)}}function O(n,o){if(1&n&&t._UZ(0,"img",5),2&n){const r=t.oxw();t.Q6J("src",r.iconImage,t.LSH)}}const F=function(n,o){return{"border-radius":n,border:o,padding:"2pt"}};let J=(()=>{var n;class o{constructor(e,i,s){this.renderer=e,this.macroDeckService=i,this.sanitizer=s,this.widgetGridComponent=p,this.longPressTrigger=!1}updateWidget(e){this.widget=e;const i=e.widgetContent;this.foregroundImage=null!=i&&i.labelBase64?this.sanitizer.bypassSecurityTrustResourceUrl("data:image/jpg;base64,"+(null==i?void 0:i.labelBase64)):void 0,this.iconImage=null!=i&&i.iconBase64?this.sanitizer.bypassSecurityTrustResourceUrl("data:image/jpg;base64,"+(null==i?void 0:i.iconBase64)):void 0,this.backgroundStyle={"background-color":e.backgroundColorHex},this.borderColor=e.backgroundColorHex?this.adjustColor(e.backgroundColorHex,-40):void 0}onMouseUp(e){if(this.setClass(e.currentTarget,"pressed",!1),this.longPressTrigger){if(void 0===this.widget)return;this.emitInteraction(m.Q.ButtonLongPressRelease)}else this.emitInteraction(m.Q.ButtonShortPressRelease);this.longPressTrigger=!1,clearTimeout(this.longPressTimeout)}onMouseDown(e){this.setClass(e.currentTarget,"pressed",!0),this.emitInteraction(m.Q.ButtonPress),this.longPressTimeout=setTimeout(()=>{this.longPressTrigger=!0,this.emitInteraction(m.Q.ButtonLongPress)},1e3)}setClass(e,i,s){const c=e.classList.contains(i);s&&!c?this.renderer.addClass(e,i):!s&&c&&this.renderer.removeClass(e,i)}adjustColor(e,i){return"#"+e.replace(/^#/,"").replace(/../g,s=>("0"+Math.min(255,Math.max(0,parseInt(s,16)+i)).toString(16)).substr(-2))}emitInteraction(e){void 0!==this.widget&&this.macroDeckService.interaction.emit({widget:this.widget,widgetInteractionType:e})}}return(n=o).\u0275fac=function(e){return new(e||n)(t.Y36(t.Qsj),t.Y36(y.a),t.Y36(Z.H7))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-button-widget"]],decls:4,vars:7,consts:[[1,"button-widget-wrapper",3,"ngStyle","down","up"],["class","foreground",3,"src",4,"ngIf"],["class","icon",3,"src",4,"ngIf"],[1,"background",3,"ngStyle"],[1,"foreground",3,"src"],[1,"icon",3,"src"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t.NdJ("down",function(c){return i.onMouseDown(c)})("up",function(c){return i.onMouseUp(c)}),t.YNc(1,B,1,1,"img",1),t.YNc(2,O,1,1,"img",2),t._UZ(3,"div",3),t.qZA()),2&e&&(t.Q6J("ngStyle",t.WLB(4,F,i.widgetGridComponent.borderRadiusPoints+"pt","2pt solid "+i.borderColor)),t.xp6(1),t.Q6J("ngIf",i.foregroundImage),t.xp6(1),t.Q6J("ngIf",i.iconImage),t.xp6(1),t.Q6J("ngStyle",i.backgroundStyle))},dependencies:[g.PC,g.O5],styles:[".button-widget-wrapper[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:hidden;border-radius:inherit;transition:all .07s ease-out;box-sizing:border-box}.foreground[_ngcontent-%COMP%], .icon[_ngcontent-%COMP%], .background[_ngcontent-%COMP%]{background-size:cover;background-repeat:no-repeat;background-position:center;position:absolute;height:100%;width:100%;object-fit:fill;top:0;right:0;bottom:0;left:0;transition:background-color .3s ease-out;transform:translateZ(0);-webkit-backface-visibility:hidden;-moz-backface-visibility:hidden;-ms-backface-visibility:hidden}.background[_ngcontent-%COMP%]{z-index:1}.icon[_ngcontent-%COMP%]{z-index:2}.foreground[_ngcontent-%COMP%]{z-index:3}.pressed[_ngcontent-%COMP%]{transform:scale(.8)}"]}),o})();const Q=function(n){return{"border-radius":n}};let Y=(()=>{var n;class o{constructor(){this.WidgetGridComponent=p}updateWidget(e){this.backgroundStyle={"background-color":e.backgroundColorHex}}}return(n=o).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-empty-widget"]],decls:2,vars:4,consts:[[1,"empty-widget-wrapper",3,"ngStyle"],[1,"background",3,"ngStyle"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"div",1),t.qZA()),2&e&&(t.Q6J("ngStyle",t.VKq(2,Q,i.WidgetGridComponent.borderRadiusPoints+"pt")),t.xp6(1),t.Q6J("ngStyle",i.backgroundStyle))},dependencies:[g.PC],styles:[".empty-widget-wrapper[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:hidden;border-radius:inherit;transition:all .1s ease-out}.background[_ngcontent-%COMP%]{background-size:cover;background-repeat:no-repeat;background-position:center;position:absolute;top:0;right:0;bottom:0;left:0}.background[_ngcontent-%COMP%]{z-index:1}"]}),o})();const R=["contentRef"];function E(n,o){}let H=(()=>{var n;class o{set data(e){this.updateContent(e)}constructor(){this.subscription=new C.w0,this.componentCreated=!1}updateContent(e){var i;if((null==e?void 0:e.widgetContentType)!==this.currentContentType&&(null===(i=this.vcr)||void 0===i||i.clear(),this.componentCreated=!1),void 0!==this.vcr&&void 0!==e){switch(this.currentContentType=e.widgetContentType,e.widgetContentType){case w.k.empty:this.componentCreated||(this.ref=this.vcr.createComponent(Y)),this.ref.instance.updateWidget(e);break;case w.k.button:this.componentCreated||(this.ref=this.vcr.createComponent(J)),this.ref.instance.updateWidget(e)}this.componentCreated=!0,this.ref.location.nativeElement.setAttribute("class","flex-grow-1")}}ngOnDestroy(){this.subscription.unsubscribe()}}return(n=o).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-widget-content"]],viewQuery:function(e,i){if(1&e&&t.Gf(R,5,t.s_b),2&e){let s;t.iGM(s=t.CRH())&&(i.vcr=s.first)}},inputs:{data:"data"},decls:2,vars:0,consts:[["contentRef",""]],template:function(e,i){1&e&&t.YNc(0,E,0,0,"ng-template",null,0,t.W1O)}}),o})(),G=(()=>{var n;class o{}return(n=o).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[g.ez,k.u5,l.Pc,I]}),o})();t.B6R(p,[g.sg,g.PC,H],[])}}]);