"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5015],{4625:(y,v,d)=>{d.d(v,{k:()=>l});var l=function(t){return t[t.empty=0]="empty",t[t.button=100]="button",t}(l||{})},4260:(y,v,d)=>{d.d(v,{Q:()=>l});var l=function(t){return t[t.ButtonPress=1e3]="ButtonPress",t[t.ButtonShortPressRelease=1001]="ButtonShortPressRelease",t[t.ButtonLongPress=1010]="ButtonLongPress",t[t.ButtonLongPressRelease=1011]="ButtonLongPressRelease",t}(l||{})},231:(y,v,d)=>{d.d(v,{a:()=>t});var l=d(9468);let t=(()=>{var a;class C{constructor(){this.configUpdate=new l.vpe,this.interaction=new l.vpe,this.widgets=[],this.rows=3,this.columns=5,this.buttonSpacing=10,this.buttonRadius=40,this.buttonBackground=!0}setConfig(f){this.rows=f.Rows,this.columns=f.Columns,this.buttonSpacing=f.ButtonSpacing,this.buttonRadius=f.ButtonRadius,this.buttonBackground=f.ButtonBackground,this.configUpdate.emit()}setWidgets(f){this.widgets=f}updateWidget(f){let m=this.widgets.findIndex(w=>w.row==f.row&&w.column==f.column);-1!==m?this.widgets[m]=f:this.widgets.push(f)}}return(a=C).\u0275fac=function(f){return new(f||a)},a.\u0275prov=l.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),C})()},5015:(y,v,d)=>{d.d(v,{i:()=>z});var l=d(5861),t=d(9468),a=d(9843);let C=(()=>{var i;class n{constructor(e){this.modalController=e,this.url=""}ngOnInit(){}dismiss(){var e=this;return(0,l.Z)(function*(){yield e.modalController.dismiss()})()}}return(i=n).\u0275fac=function(e){return new(e||i)(t.Y36(a.IN))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-connection-failed"]],decls:30,vars:2,consts:[["slot","end"],[3,"strong","click"],[1,"ion-padding"],[1,"d-block","mt-3"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t._uU(3,"Connection failed"),t.qZA(),t.TgZ(4,"ion-buttons",0)(5,"ion-button",1),t.NdJ("click",function(){return o.dismiss()}),t._uU(6,"Close"),t.qZA()()()(),t.TgZ(7,"ion-content",2)(8,"ion-text")(9,"h4"),t._uU(10),t.qZA(),t.TgZ(11,"b",3),t._uU(12,"There can be multiple reasons why this happens:"),t.qZA(),t.TgZ(13,"ul")(14,"li"),t._uU(15,"Your anti virus software or firewall blocks Macro Deck (Common issue)"),t.qZA(),t.TgZ(16,"li"),t._uU(17,"The wrong network adapter is chosen in the settings on the PC app"),t.qZA(),t.TgZ(18,"li"),t._uU(19,"The chosen port is used by another application"),t.qZA(),t.TgZ(20,"li"),t._uU(21,"Your computer and this device are not in the same network"),t.qZA(),t.TgZ(22,"li"),t._uU(23,"If you're using VPN services, disable them"),t.qZA(),t.TgZ(24,"li"),t._uU(25,"A restart of your computer can help sometimes"),t.qZA(),t.TgZ(26,"li"),t._uU(27,"If you're using a 5GHz Wi-Fi connection, try to switch to 2,4GHz temporarily"),t.qZA(),t.TgZ(28,"li"),t._uU(29,"Some routers block the communication between Ethernet and Wi-Fi. Check your router settings. Look for SSID isolation or AP isolation and disable it."),t.qZA()()()()),2&e&&(t.xp6(5),t.Q6J("strong",!0),t.xp6(5),t.hij("I was not able to connect to ",o.url," \u{1f641}"))},dependencies:[a.YG,a.Sm,a.W2,a.Gu,a.yW,a.wd,a.sr]}),n})();class S{static getConnectedMessage(n){return{Method:"CONNECTED","Client-Id":n,API:"20","Device-Type":"Web"}}static getGetButtonsMessage(){return{Method:"GET_BUTTONS"}}}let f=(()=>{var i;class n{constructor(e){this.modalController=e}ngOnInit(){}dismiss(){var e=this;return(0,l.Z)(function*(){yield e.modalController.dismiss()})()}}return(i=n).\u0275fac=function(e){return new(e||i)(t.Y36(a.IN))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-insecure-connection"]],decls:17,vars:1,consts:[["slot","end"],[3,"strong","click"],[1,"ion-padding"],[1,"d-block","mt-3"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t._uU(3,"Connection failed"),t.qZA(),t.TgZ(4,"ion-buttons",0)(5,"ion-button",1),t.NdJ("click",function(){return o.dismiss()}),t._uU(6,"Close"),t.qZA()()()(),t.TgZ(7,"ion-content",2)(8,"ion-text")(9,"h4"),t._uU(10,"I was able to connect but there were some problems \u26a0\ufe0f"),t.qZA(),t.TgZ(11,"span",3),t._uU(12," It seems like your browser blocks the connection because of security issues."),t._UZ(13,"br"),t._uU(14," This is caused by the client being accessed over a https connection and the server is not accessed wss."),t._UZ(15,"br"),t._uU(16," To solve this, allow insecure connections from https in your browser. "),t.qZA()()()),2&e&&(t.xp6(5),t.Q6J("strong",!0))},dependencies:[a.YG,a.Sm,a.W2,a.Gu,a.yW,a.wd,a.sr]}),n})();var m=d(8645),w=d(305),B=d(5592),P=d(7394),L=d(4552);class k extends m.x{constructor(n=1/0,r=1/0,e=L.l){super(),this._bufferSize=n,this._windowTime=r,this._timestampProvider=e,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=r===1/0,this._bufferSize=Math.max(1,n),this._windowTime=Math.max(1,r)}next(n){const{isStopped:r,_buffer:e,_infiniteTimeWindow:o,_timestampProvider:s,_windowTime:c}=this;r||(e.push(n),!o&&e.push(s.now()+c)),this._trimBuffer(),super.next(n)}_subscribe(n){this._throwIfClosed(),this._trimBuffer();const r=this._innerSubscribe(n),{_infiniteTimeWindow:e,_buffer:o}=this,s=o.slice();for(let c=0;c<s.length&&!n.closed;c+=e?1:2)n.next(s[c]);return this._checkFinalizedStatuses(n),r}_trimBuffer(){const{_bufferSize:n,_timestampProvider:r,_buffer:e,_infiniteTimeWindow:o}=this,s=(o?1:2)*n;if(n<1/0&&s<e.length&&e.splice(0,e.length-s),!o){const c=r.now();let h=0;for(let u=1;u<e.length&&e[u]<=c;u+=2)h=u;h&&e.splice(0,h+1)}}}const U={url:"",deserializer:i=>JSON.parse(i.data),serializer:i=>JSON.stringify(i)};class T extends m.u{constructor(n,r){if(super(),this._socket=null,n instanceof B.y)this.destination=r,this.source=n;else{const e=this._config=Object.assign({},U);if(this._output=new m.x,"string"==typeof n)e.url=n;else for(const o in n)n.hasOwnProperty(o)&&(e[o]=n[o]);if(!e.WebSocketCtor&&WebSocket)e.WebSocketCtor=WebSocket;else if(!e.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new k}}lift(n){const r=new T(this._config,this.destination);return r.operator=n,r.source=this,r}_resetState(){this._socket=null,this.source||(this.destination=new k),this._output=new m.x}multiplex(n,r,e){const o=this;return new B.y(s=>{try{o.next(n())}catch(h){s.error(h)}const c=o.subscribe({next:h=>{try{e(h)&&s.next(h)}catch(u){s.error(u)}},error:h=>s.error(h),complete:()=>s.complete()});return()=>{try{o.next(r())}catch(h){s.error(h)}c.unsubscribe()}})}_connectSocket(){const{WebSocketCtor:n,protocol:r,url:e,binaryType:o}=this._config,s=this._output;let c=null;try{c=r?new n(e,r):new n(e),this._socket=c,o&&(this._socket.binaryType=o)}catch(u){return void s.error(u)}const h=new P.w0(()=>{this._socket=null,c&&1===c.readyState&&c.close()});c.onopen=u=>{const{_socket:p}=this;if(!p)return c.close(),void this._resetState();const{openObserver:b}=this._config;b&&b.next(u);const Z=this.destination;this.destination=w.Lv.create(g=>{if(1===c.readyState)try{const{serializer:_}=this._config;c.send(_(g))}catch(_){this.destination.error(_)}},g=>{const{closingObserver:_}=this._config;_&&_.next(void 0),g&&g.code?c.close(g.code,g.reason):s.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),this._resetState()},()=>{const{closingObserver:g}=this._config;g&&g.next(void 0),c.close(),this._resetState()}),Z&&Z instanceof k&&h.add(Z.subscribe(this.destination))},c.onerror=u=>{this._resetState(),s.error(u)},c.onclose=u=>{c===this._socket&&this._resetState();const{closeObserver:p}=this._config;p&&p.next(u),u.wasClean?s.complete():s.error(u)},c.onmessage=u=>{try{const{deserializer:p}=this._config;s.next(p(u))}catch(p){s.error(p)}}}_subscribe(n){const{source:r}=this;return r?r.subscribe(n):(this._socket||this._connectSocket(),this._output.subscribe(n),n.add(()=>{const{_socket:e}=this;0===this._output.observers.length&&(e&&(1===e.readyState||0===e.readyState)&&e.close(),this._resetState())}),n)}unsubscribe(){const{_socket:n}=this;n&&(1===n.readyState||0===n.readyState)&&n.close(),this._resetState(),super.unsubscribe()}}let M=(()=>{var i;class n{constructor(e){this.modalController=e}dismiss(){var e=this;return(0,l.Z)(function*(){yield e.modalController.dismiss()})()}}return(i=n).\u0275fac=function(e){return new(e||i)(t.Y36(a.IN))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-connection-lost"]],decls:13,vars:1,consts:[["slot","end"],[3,"strong","click"],[1,"ion-padding"],[1,"d-block","mt-3"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t._uU(3,"Connection lost"),t.qZA(),t.TgZ(4,"ion-buttons",0)(5,"ion-button",1),t.NdJ("click",function(){return o.dismiss()}),t._uU(6,"Close"),t.qZA()()()(),t.TgZ(7,"ion-content",2)(8,"ion-text")(9,"h4"),t._uU(10,"I lost the connection to the server \u{1fae4}"),t.qZA(),t.TgZ(11,"b",3),t._uU(12,"Maybe the server was stopped or the connection dropped."),t.qZA()()()),2&e&&(t.xp6(5),t.Q6J("strong",!0))},dependencies:[a.YG,a.Sm,a.W2,a.Gu,a.yW,a.wd,a.sr]}),n})();var A=d(553);let x=(()=>{var i;class n{constructor(e){this.loadingController=e}dismiss(){var e=this;return(0,l.Z)(function*(){try{var o;yield null===(o=e.loadingMessage)||void 0===o?void 0:o.dismiss(),e.loadingMessage=void 0}catch(s){console.error(s)}})()}showText(e){var o=this;return(0,l.Z)(function*(){try{yield o.dismiss(),o.loadingMessage=yield o.loadingController.create({message:e}),yield o.loadingMessage.present()}catch(s){console.error(s)}})()}}return(i=n).\u0275fac=function(e){return new(e||i)(t.LFG(a.HT))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),n})();var E=d(3660),I=d(5877),G=d(4625),O=d(4260),D=d(231);let R=(()=>{var i;class n{constructor(e,o,s){this.macroDeckService=e,this.loadingService=o,this.router=s,this.initialConfigReceived=!1,e.interaction.subscribe(c=>{this.handleInteraction(c)})}handleMessage(e){var o=this;return(0,l.Z)(function*(){if(e.Method)switch(e.Method){case"GET_CONFIG":o.macroDeckService.setConfig(e),o.initialConfigReceived||(o.initialConfigReceived=!0,yield o.router.navigate(["deck"],{replaceUrl:!1,skipLocationChange:!0}),yield o.loadingService.dismiss()),o.send(S.getGetButtonsMessage());break;case"GET_BUTTONS":if(!o.initialConfigReceived)return;let s=e.Buttons.map(b=>o.mapProtocol2ButtonToWidget(b));o.macroDeckService.setWidgets(s);break;case"UPDATE_BUTTON":if(!o.initialConfigReceived)return;let c=o.mapProtocol2ButtonToWidget(e.Buttons[0]);o.macroDeckService.updateWidget(c);break;case"UPDATE_LABEL":if(!o.initialConfigReceived)return;let h=e.Buttons[0],u=o.macroDeckService.widgets.find(b=>b.row===h.Position_Y&&b.column===h.Position_X);if(void 0===u)return;(null==u?void 0:u.widgetContent).labelBase64=h.LabelBase64,o.macroDeckService.updateWidget(u)}})()}setWebsocketSubject(e){this.initialConfigReceived=!1,this.socket=e}mapProtocol2ButtonToWidget(e){return{backgroundColorHex:e.BackgroundColorHex,colSpan:1,column:e.Position_X,row:e.Position_Y,rowSpan:1,widgetContentType:G.k.button,widgetContent:{iconBase64:e.IconBase64,labelBase64:e.LabelBase64}}}send(e){var o;null===(o=this.socket)||void 0===o||o.next(e)}handleInteraction(e){e.widgetInteractionType===O.Q.ButtonPress&&this.send({Method:"BUTTON_PRESS",Message:`${e.widget.row}_${e.widget.column}`})}}return(i=n).\u0275fac=function(e){return new(e||i)(t.LFG(D.a),t.LFG(x),t.LFG(I.F0))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),n})(),N=(()=>{var i;class n{constructor(e){this.protocol2Service=e,this.protocolVersion=2}handleMessage(e){var o=this;return(0,l.Z)(function*(){2===o.protocolVersion&&(yield o.protocol2Service.handleMessage(e))})()}setWebsocketSubject(e){this.protocol2Service.setWebsocketSubject(e)}}return(i=n).\u0275fac=function(e){return new(e||i)(t.LFG(R))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),n})(),z=(()=>{var i;class n{constructor(e,o,s,c,h){this.loadingService=e,this.modalController=o,this.settingsService=s,this.router=c,this.protocolHandlerService=h,this.isConnected=!1,this.url="",this.connectionClosed=new m.x,this.connectionOpened=new m.x,this.connectionLost=new t.vpe,this.subscribeOpenClose()}reconnect(){var e=this;return(0,l.Z)(function*(){yield e.connectToString(e.url)})()}connectToString(e){var o=this;return(0,l.Z)(function*(){var s;o.url=e,yield o.loadingService.showText(`Connecting to ${o.url}...`),o.socket=function W(i){return new T(i)}({url:o.url,closeObserver:o.connectionClosed,openObserver:o.connectionOpened}),o.socket.subscribe({next:(s=(0,l.Z)(function*(c){yield o.protocolHandlerService.handleMessage(c)}),function(h){return s.apply(this,arguments)}),error:function(){var s=(0,l.Z)(function*(c){yield o.loadingService.dismiss(),c instanceof DOMException&&"SecurityError"===c.name&&(yield o.showInsecureConnectionModal())});return function(h){return s.apply(this,arguments)}}()})})()}connect(e,o,s){var c=this;return(0,l.Z)(function*(){yield c.connectToString((s?"wss://":"ws://")+e+":"+o)})()}subscribeOpenClose(){var e=this;this.connectionClosed.subscribe(function(){var o=(0,l.Z)(function*(s){switch(console.info("Closed with code "+s.code),yield e.loadingService.dismiss(),s.code){case 1e3:break;case 1005:case 1006:A.N.webVersion?e.connectionLost.emit():e.isConnected?yield e.showConnectionLostModal():yield e.showConnectionFailedModal()}e.isConnected=!1,yield e.router.navigate([""],{replaceUrl:!1,skipLocationChange:!0})});return function(s){return o.apply(this,arguments)}}()),this.connectionOpened.subscribe((0,l.Z)(function*(){var o;e.protocolHandlerService.setWebsocketSubject(e.socket),e.isConnected=!0,yield e.loadingService.showText("Waiting for the host to accept the connection...");let s=yield e.settingsService.getClientId();null===(o=e.socket)||void 0===o||o.next(S.getConnectedMessage(s))}))}close(){var e;null===(e=this.socket)||void 0===e||e.complete()}send(e){var o;null===(o=this.socket)||void 0===o||o.next(e)}showConnectionFailedModal(){var e=this;return(0,l.Z)(function*(){yield(yield e.modalController.create({component:C,componentProps:{url:e.url}})).present()})()}showInsecureConnectionModal(){var e=this;return(0,l.Z)(function*(){yield(yield e.modalController.create({component:f})).present()})()}showConnectionLostModal(){var e=this;return(0,l.Z)(function*(){yield(yield e.modalController.create({component:M})).present()})()}}return(i=n).\u0275fac=function(e){return new(e||i)(t.LFG(x),t.LFG(a.IN),t.LFG(E.g),t.LFG(I.F0),t.LFG(N))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),n})()}}]);